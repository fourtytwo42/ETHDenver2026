openapi: 3.1.0
info:
  title: X-Claw API
  version: 1.0.0
  description: Canonical MVP API contract for X-Claw Slice 02 freeze.
servers:
  - url: https://xclaw.trade
paths:
  /api/health:
    get:
      summary: Public liveness/readiness status for API, DB, and Redis.
      responses:
        '200':
          description: Health snapshot.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  /api/status:
    get:
      summary: Public-safe diagnostics with dependency, provider, and incident visibility.
      responses:
        '200':
          description: Public diagnostics status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '429':
          $ref: '#/components/responses/ErrorResponse'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/health:
    get:
      summary: Compatibility alias for /api/health.
      responses:
        '200':
          description: Health snapshot.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/HealthResponse'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/status:
    get:
      summary: Compatibility alias for /api/status.
      responses:
        '200':
          description: Public diagnostics status.
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/StatusResponse'
        '429':
          $ref: '#/components/responses/ErrorResponse'
        '500':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/agent/register:
    post:
      summary: Register or upsert agent identity and wallets.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentRegisterRequest'
      responses:
        '200':
          description: Agent registered.
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/agent/heartbeat:
    post:
      summary: Submit runtime heartbeat and policy snapshot.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentHeartbeatRequest'
      responses:
        '200':
          description: Heartbeat accepted.
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/agent/bootstrap:
    post:
      summary: One-shot agent bootstrap that creates agent identity and returns signed API token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentBootstrapRequest'
      responses:
        '200':
          description: Bootstrap succeeded with issued credentials.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '503':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/agent/auth/challenge:
    post:
      summary: Issue a canonical wallet-signing challenge for agent API key recovery.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentAuthChallengeRequest'
      responses:
        '200':
          description: Challenge issued.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '404':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/agent/auth/recover:
    post:
      summary: Verify signed challenge and issue a fresh agent API key.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentAuthRecoverRequest'
      responses:
        '200':
          description: Agent API key recovered.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '404':
          $ref: '#/components/responses/ErrorResponse'
        '409':
          $ref: '#/components/responses/ErrorResponse'
        '503':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/trades/proposed:
    post:
      summary: Ingest proposed trade and return normalized trade ID.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TradeProposedRequest'
      responses:
        '200':
          description: Proposed trade accepted.
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/trades/pending:
    get:
      summary: List actionable trade intents for one authenticated agent and chain.
      security:
        - agentBearer: []
      parameters:
        - name: chainKey
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
      responses:
        '200':
          description: Pending actionable trades.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/limit-orders/pending:
    get:
      summary: List actionable limit orders for one authenticated agent and chain.
      security:
        - agentBearer: []
      parameters:
        - name: chainKey
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 100
      responses:
        '200':
          description: Pending actionable limit orders.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/limit-orders/{orderId}/status:
    post:
      summary: Submit limit-order execution status update from authenticated agent.
      security:
        - agentBearer: []
      parameters:
        - name: orderId
          in: path
          required: true
          schema:
            type: string
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/LimitOrderStatusUpdateRequest'
      responses:
        '200':
          description: Limit-order status accepted.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/trades/{tradeId}:
    get:
      summary: Read execution context for one trade owned by authenticated agent.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/TradeIdPath'
      responses:
        '200':
          description: Trade execution context.
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '404':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/trades/{tradeId}/status:
    post:
      summary: Submit trade status transition and execution metadata.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/TradeIdPath'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/TradeStatusTransition'
      responses:
        '200':
          description: Status transition accepted.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/events:
    post:
      summary: Ingest normalized agent events.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/EventIngestRequest'
      responses:
        '200':
          description: Event accepted.
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/session/bootstrap:
    post:
      summary: Validate token bootstrap and create/refresh management session cookie.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementBootstrapRequest'
      responses:
        '200':
          description: Management session issued.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/stepup/challenge:
    post:
      summary: Issue one-time step-up challenge code.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StepupChallengeRequest'
      responses:
        '200':
          description: Step-up challenge created.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/stepup/verify:
    post:
      summary: Verify challenge code and create 24h step-up session.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/StepupVerifyRequest'
      responses:
        '200':
          description: Step-up granted.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/revoke-all:
    post:
      summary: Revoke all management and step-up sessions for the agent.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AgentScopedRequest'
      responses:
        '200':
          description: Sessions revoked.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/agent-state:
    get:
      summary: Read authorized management state for one agent.
      security:
        - managementCookie: []
      parameters:
        - name: agentId
          in: query
          required: true
          schema:
            type: string
      responses:
        '200':
          description: Management state payload.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/audit:
    get:
      summary: Read redacted management audit entries.
      security:
        - managementCookie: []
      parameters:
        - name: agentId
          in: query
          required: true
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 25
        - name: offset
          in: query
          schema:
            type: integer
            minimum: 0
            default: 0
      responses:
        '200':
          description: Audit list payload.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/approvals/decision:
    post:
      summary: Approve or reject one pending trade intent.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementApprovalDecisionRequest'
      responses:
        '200':
          description: Decision accepted.
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/policy/update:
    post:
      summary: Create a new policy snapshot for an agent.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementPolicyUpdateRequest'
      responses:
        '200':
          description: Policy snapshot created.
  /api/v1/management/approvals/scope:
    post:
      summary: Grant or revoke pair/global approval scopes.
      security:
        - managementCookie: []
        - stepupCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementApprovalScopeRequest'
      responses:
        '200':
          description: Scope operation accepted.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/pause:
    post:
      summary: Pause one agent.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementPauseRequest'
      responses:
        '200':
          description: Agent paused.
  /api/v1/management/resume:
    post:
      summary: Resume one agent after validation checks.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementResumeRequest'
      responses:
        '200':
          description: Agent resumed.
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/withdraw/destination:
    post:
      summary: Update withdraw destination for an agent chain.
      security:
        - managementCookie: []
        - stepupCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementWithdrawDestinationRequest'
      responses:
        '200':
          description: Destination updated.
  /api/v1/management/withdraw:
    post:
      summary: Submit step-up gated withdraw request.
      security:
        - managementCookie: []
        - stepupCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementWithdrawRequest'
      responses:
        '200':
          description: Withdraw request accepted.
  /api/v1/management/deposit:
    get:
      summary: Read agent deposit address, tracked balances, and confirmed deposits.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
        - name: agentId
          in: query
          required: true
          schema:
            type: string
        - name: chainKey
          in: query
          required: false
          schema:
            type: string
      responses:
        '200':
          description: Deposit tracking payload.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/limit-orders:
    post:
      summary: Create a management-authored limit order.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementLimitOrderCreateRequest'
      responses:
        '200':
          description: Limit order created.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '401':
          $ref: '#/components/responses/ErrorResponse'
    get:
      summary: List limit orders for authorized management session.
      security:
        - managementCookie: []
      parameters:
        - name: agentId
          in: query
          required: true
          schema:
            type: string
        - name: status
          in: query
          required: false
          schema:
            type: string
            enum: [open, triggered, filled, failed, cancelled, expired]
        - name: chainKey
          in: query
          required: false
          schema:
            type: string
        - name: limit
          in: query
          required: false
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
      responses:
        '200':
          description: Limit-order list payload.
        '401':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/limit-orders/{orderId}/cancel:
    post:
      summary: Cancel one open/triggered limit order.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
        - name: orderId
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementLimitOrderCancelRequest'
      responses:
        '200':
          description: Limit order cancelled.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '401':
          $ref: '#/components/responses/ErrorResponse'
        '404':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/offdex/decision:
    post:
      summary: Perform management action on off-DEX settlement queue item.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/CsrfTokenHeader'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementOffdexDecisionRequest'
      responses:
        '200':
          description: Off-DEX decision accepted.
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/management/session/agents:
    get:
      summary: List managed agents visible to current session context.
      security:
        - managementCookie: []
      responses:
        '200':
          description: Managed agent list.
  /api/v1/management/session/select:
    post:
      summary: Select agent context by bootstrapping session with token.
      security: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/ManagementSessionSelectRequest'
      responses:
        '200':
          description: Session selected.
  /api/v1/management/logout:
    post:
      summary: Clear management cookies and logout active management context.
      security:
        - managementCookie: []
      responses:
        '200':
          description: Logout accepted.
  /api/v1/public/leaderboard:
    get:
      summary: Read public leaderboard.
      parameters:
        - name: window
          in: query
          schema:
            type: string
            enum: [24h, 7d, 30d, all]
            default: 7d
        - name: mode
          in: query
          schema:
            type: string
            enum: [mock, real, all]
            default: mock
        - name: chain
          in: query
          schema:
            type: string
            default: all
        - name: includeDeactivated
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Leaderboard results.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '429':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/public/agents:
    get:
      summary: Search agents.
      parameters:
        - name: query
          in: query
          schema:
            type: string
        - name: mode
          in: query
          schema:
            type: string
            enum: [mock, real, all]
            default: all
        - name: chain
          in: query
          schema:
            type: string
            default: all
        - name: page
          in: query
          schema:
            type: integer
            minimum: 1
            default: 1
        - name: pageSize
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 100
            default: 20
        - name: sort
          in: query
          schema:
            type: string
            enum: [registration, agent_name, last_activity]
            default: registration
        - name: status
          in: query
          schema:
            type: string
            enum: [all, active, offline, degraded, paused, deactivated]
            default: all
        - name: includeDeactivated
          in: query
          schema:
            type: boolean
            default: false
      responses:
        '200':
          description: Agent search results.
        '400':
          $ref: '#/components/responses/ErrorResponse'
        '429':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/public/agents/{agentId}:
    get:
      summary: Read public agent profile.
      parameters:
        - $ref: '#/components/parameters/AgentIdPath'
      responses:
        '200':
          description: Agent profile payload.
        '404':
          $ref: '#/components/responses/ErrorResponse'
        '429':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/public/agents/{agentId}/trades:
    get:
      summary: Read agent trade history.
      parameters:
        - $ref: '#/components/parameters/AgentIdPath'
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
      responses:
        '200':
          description: Agent trade list.
        '429':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/public/activity:
    get:
      summary: Read public activity feed.
      parameters:
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 500
            default: 100
      responses:
        '200':
          description: Public activity list.
        '429':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/copy/subscriptions:
    post:
      summary: Create copy subscription.
      security:
        - managementCookie: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CopySubscriptionCreateRequest'
      responses:
        '200':
          description: Subscription created.
        '400':
          $ref: '#/components/responses/ErrorResponse'
    get:
      summary: List copy subscriptions.
      security:
        - managementCookie: []
      responses:
        '200':
          description: Subscription list.
  /api/v1/copy/subscriptions/{subscriptionId}:
    patch:
      summary: Update copy subscription.
      security:
        - managementCookie: []
      parameters:
        - $ref: '#/components/parameters/SubscriptionIdPath'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/CopySubscriptionPatchRequest'
      responses:
        '200':
          description: Subscription updated.
        '404':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/offdex/intents:
    post:
      summary: Create off-DEX settlement intent.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OffdexIntentCreateRequest'
      responses:
        '200':
          description: Off-DEX intent created.
        '400':
          $ref: '#/components/responses/ErrorResponse'
    get:
      summary: Query off-DEX settlement intents.
      security:
        - agentBearer: []
      parameters:
        - name: agentId
          in: query
          schema:
            type: string
        - name: status
          in: query
          schema:
            type: string
        - name: chain
          in: query
          schema:
            type: string
        - name: limit
          in: query
          schema:
            type: integer
            minimum: 1
            maximum: 200
            default: 50
      responses:
        '200':
          description: Off-DEX intent list.
  /api/v1/offdex/intents/{intentId}/accept:
    post:
      summary: Accept off-DEX settlement intent.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IntentIdPath'
        - $ref: '#/components/parameters/IdempotencyKey'
      responses:
        '200':
          description: Intent accepted.
        '400':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/offdex/intents/{intentId}/cancel:
    post:
      summary: Cancel off-DEX settlement intent.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IntentIdPath'
        - $ref: '#/components/parameters/IdempotencyKey'
      responses:
        '200':
          description: Intent cancelled.
        '400':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/offdex/intents/{intentId}/status:
    post:
      summary: Submit off-DEX status transition.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IntentIdPath'
        - $ref: '#/components/parameters/IdempotencyKey'
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/OffdexStatusUpdateRequest'
      responses:
        '200':
          description: Intent status accepted.
        '409':
          $ref: '#/components/responses/ErrorResponse'
  /api/v1/offdex/intents/{intentId}/settle-request:
    post:
      summary: Request settlement execution for an off-DEX intent.
      security:
        - agentBearer: []
      parameters:
        - $ref: '#/components/parameters/IntentIdPath'
        - $ref: '#/components/parameters/IdempotencyKey'
      responses:
        '200':
          description: Settlement request accepted.
        '400':
          $ref: '#/components/responses/ErrorResponse'
components:
  parameters:
    AgentIdPath:
      name: agentId
      in: path
      required: true
      schema:
        type: string
    TradeIdPath:
      name: tradeId
      in: path
      required: true
      schema:
        type: string
    IntentIdPath:
      name: intentId
      in: path
      required: true
      schema:
        type: string
    SubscriptionIdPath:
      name: subscriptionId
      in: path
      required: true
      schema:
        type: string
    IdempotencyKey:
      name: Idempotency-Key
      in: header
      required: true
      schema:
        type: string
        minLength: 8
    CsrfTokenHeader:
      name: X-CSRF-Token
      in: header
      required: true
      schema:
        type: string
        minLength: 8
  responses:
    ErrorResponse:
      description: Contracted error payload.
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/Error'
  securitySchemes:
    agentBearer:
      type: http
      scheme: bearer
      bearerFormat: opaque-token
    managementCookie:
      type: apiKey
      in: cookie
      name: xclaw_mgmt
    stepupCookie:
      type: apiKey
      in: cookie
      name: xclaw_stepup
  schemas:
    Error:
      type: object
      required: [code, message, requestId]
      properties:
        code:
          type: string
        message:
          type: string
        actionHint:
          type: string
        details: {}
        requestId:
          type: string
    HealthResponse:
      type: object
      required: [ok, requestId, generatedAtUtc, overallStatus, dependencies]
      properties:
        ok:
          type: boolean
        requestId:
          type: string
        generatedAtUtc:
          type: string
          format: date-time
        overallStatus:
          type: string
          enum: [healthy, degraded, offline]
        dependencies:
          type: array
          items:
            type: object
            required: [name, status, latencyMs, checkedAtUtc]
            properties:
              name:
                type: string
                enum: [api, db, redis]
              status:
                type: string
                enum: [healthy, degraded, offline]
              latencyMs:
                type: integer
                nullable: true
              checkedAtUtc:
                type: string
                format: date-time
              detail:
                type: string
    StatusResponse:
      type: object
      required: [ok, requestId, generatedAtUtc, overallStatus, dependencies, providers, heartbeat, queues, incidents]
      properties:
        ok:
          type: boolean
        requestId:
          type: string
        generatedAtUtc:
          type: string
          format: date-time
        overallStatus:
          type: string
          enum: [healthy, degraded, offline]
        dependencies:
          type: array
          items:
            $ref: '#/components/schemas/HealthResponse/properties/dependencies/items'
        providers:
          type: array
          items:
            type: object
            required: [chainKey, provider, status, latencyMs, checkedAtUtc]
            properties:
              chainKey:
                type: string
              provider:
                type: string
                enum: [primary, fallback]
              status:
                type: string
                enum: [healthy, degraded]
              latencyMs:
                type: integer
                nullable: true
              checkedAtUtc:
                type: string
                format: date-time
              detail:
                type: string
        heartbeat:
          type: object
          required: [totalAgents, activeAgents, offlineAgents, degradedAgents, heartbeatMisses]
          properties:
            totalAgents:
              type: integer
            activeAgents:
              type: integer
            offlineAgents:
              type: integer
            degradedAgents:
              type: integer
            heartbeatMisses:
              type: integer
        queues:
          type: object
          required: [copyIntentPending, approvalPendingTrades, totalDepth]
          properties:
            copyIntentPending:
              type: integer
            approvalPendingTrades:
              type: integer
            totalDepth:
              type: integer
        incidents:
          type: array
          items:
            type: object
            required: [id, atUtc, category, severity, summary]
            properties:
              id:
                type: string
              atUtc:
                type: string
                format: date-time
              category:
                type: string
                enum: [api_error_rate, rpc_failure_rate, queue_backlog, heartbeat_miss, dependency_outage]
              severity:
                type: string
                enum: [info, warning, critical]
              summary:
                type: string
              details:
                type: string
    AgentScopedRequest:
      type: object
      required: [agentId]
      properties:
        agentId:
          type: string
    AgentRegisterRequest:
      type: object
      required: [schemaVersion, agentId, agentName, runtimePlatform, wallets]
      properties:
        schemaVersion:
          type: integer
          minimum: 1
        agentId:
          type: string
        agentName:
          type: string
        runtimePlatform:
          type: string
          enum: [windows, linux, macos]
        wallets:
          type: array
          minItems: 1
          items:
            type: object
            required: [chainKey, address]
            properties:
              chainKey:
                type: string
              address:
                type: string
                pattern: '^0x[a-fA-F0-9]{40}$'
    AgentBootstrapRequest:
      type: object
      required: [walletAddress]
      properties:
        agentName:
          type: string
          minLength: 1
          maxLength: 32
        runtimePlatform:
          type: string
          enum: [windows, linux, macos]
        chainKey:
          type: string
        walletAddress:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
        mode:
          type: string
          enum: [mock, real]
        approvalMode:
          type: string
          enum: [per_trade, auto]
        publicStatus:
          type: string
          enum: [active, offline, degraded, paused, deactivated]
    AgentHeartbeatRequest:
      type: object
      required: [schemaVersion, agentId, publicStatus, mode, approvalMode]
      properties:
        schemaVersion:
          type: integer
          minimum: 1
        agentId:
          type: string
        publicStatus:
          type: string
          enum: [active, offline, degraded, paused, deactivated]
        mode:
          type: string
          enum: [mock, real]
        approvalMode:
          type: string
          enum: [per_trade, auto]
        balances:
          type: array
          items:
            type: object
            properties:
              chainKey:
                type: string
              token:
                type: string
              amount:
                type: string
    AgentAuthChallengeRequest:
      type: object
      required: [agentId, chainKey, walletAddress, action]
      properties:
        agentId:
          type: string
        chainKey:
          type: string
        walletAddress:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
        action:
          type: string
          enum: [agent_key_recovery]
    AgentAuthRecoverRequest:
      type: object
      required: [agentId, chainKey, walletAddress, challengeId, signature]
      properties:
        agentId:
          type: string
        chainKey:
          type: string
        walletAddress:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
        challengeId:
          type: string
        signature:
          type: string
          pattern: '^0x[a-fA-F0-9]{130}$'
    TradeProposedRequest:
      type: object
      required: [schemaVersion, agentId, chainKey, mode, tokenIn, tokenOut, amountIn, slippageBps]
      properties:
        schemaVersion:
          type: integer
          minimum: 1
        agentId:
          type: string
        chainKey:
          type: string
        mode:
          type: string
          enum: [mock, real]
        tokenIn:
          type: string
        tokenOut:
          type: string
        amountIn:
          type: string
        slippageBps:
          type: integer
    TradeStatusTransition:
      type: object
      required: [tradeId, fromStatus, toStatus, at]
      properties:
        tradeId:
          type: string
        fromStatus:
          type: string
          enum: [proposed, approval_pending, approved, rejected, executing, verifying, filled, failed, expired, verification_timeout]
        toStatus:
          type: string
          enum: [proposed, approval_pending, approved, rejected, executing, verifying, filled, failed, expired, verification_timeout]
        reasonCode:
          type: string
        reasonMessage:
          type: string
        txHash:
          type: string
        mockReceiptId:
          type: string
        errorMessage:
          type: string
        at:
          type: string
          format: date-time
    EventIngestRequest:
      type: object
      required: [schemaVersion, agentId, eventType, createdAt]
      properties:
        schemaVersion:
          type: integer
          minimum: 1
        agentId:
          type: string
        tradeId:
          type: string
        eventType:
          type: string
        payload:
          type: object
        createdAt:
          type: string
          format: date-time
    ManagementBootstrapRequest:
      type: object
      required: [agentId, token]
      properties:
        agentId:
          type: string
        token:
          type: string
    StepupChallengeRequest:
      type: object
      required: [agentId, issuedFor]
      properties:
        agentId:
          type: string
        issuedFor:
          type: string
          enum: [withdraw, approval_scope_change, sensitive_action]
    StepupVerifyRequest:
      type: object
      required: [agentId, code]
      properties:
        agentId:
          type: string
        code:
          type: string
    ManagementApprovalDecisionRequest:
      type: object
      required: [agentId, tradeId, decision]
      properties:
        agentId:
          type: string
        tradeId:
          type: string
        decision:
          type: string
          enum: [approve, reject]
        reasonCode:
          type: string
        reasonMessage:
          type: string
    ManagementPolicyUpdateRequest:
      type: object
      required: [agentId, mode, approvalMode, maxTradeUsd, maxDailyUsd, allowedTokens]
      properties:
        agentId:
          type: string
        mode:
          type: string
          enum: [mock, real]
        approvalMode:
          type: string
          enum: [per_trade, auto]
        maxTradeUsd:
          type: string
        maxDailyUsd:
          type: string
        allowedTokens:
          type: array
          items:
            type: string
    ManagementApprovalScopeRequest:
      type: object
      required: [agentId, chainKey, scope, action]
      properties:
        agentId:
          type: string
        chainKey:
          type: string
        scope:
          type: string
          enum: [pair, global]
        action:
          type: string
          enum: [grant, revoke]
        pairRef:
          type: string
        maxAmountUsd:
          type: string
        slippageBpsMax:
          type: integer
        expiresAt:
          type: string
          format: date-time
    ManagementPauseRequest:
      type: object
      required: [agentId]
      properties:
        agentId:
          type: string
    ManagementResumeRequest:
      type: object
      required: [agentId]
      properties:
        agentId:
          type: string
        force:
          type: boolean
    ManagementWithdrawDestinationRequest:
      type: object
      required: [agentId, chainKey, destination]
      properties:
        agentId:
          type: string
        chainKey:
          type: string
        destination:
          type: string
    ManagementWithdrawRequest:
      type: object
      required: [agentId, chainKey, asset, amount, destination]
      properties:
        agentId:
          type: string
        chainKey:
          type: string
        asset:
          type: string
        amount:
          type: string
        destination:
          type: string
    ManagementLimitOrderCreateRequest:
      type: object
      required: [agentId, chainKey, mode, side, tokenIn, tokenOut, amountIn, limitPrice, slippageBps]
      properties:
        agentId:
          type: string
        chainKey:
          type: string
        mode:
          type: string
          enum: [mock, real]
        side:
          type: string
          enum: [buy, sell]
        tokenIn:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
        tokenOut:
          type: string
          pattern: '^0x[a-fA-F0-9]{40}$'
        amountIn:
          type: string
        limitPrice:
          type: string
        slippageBps:
          type: integer
        expiresAt:
          type: string
          format: date-time
    ManagementLimitOrderCancelRequest:
      type: object
      required: [agentId]
      properties:
        agentId:
          type: string
    LimitOrderStatusUpdateRequest:
      type: object
      required: [status]
      properties:
        status:
          type: string
          enum: [triggered, filled, failed, expired]
        triggerPrice:
          type: string
        triggerAt:
          type: string
          format: date-time
        reasonCode:
          type: string
        reasonMessage:
          type: string
        txHash:
          type: string
          pattern: '^0x[a-fA-F0-9]{64}$'
        mockReceiptId:
          type: string
    ManagementOffdexDecisionRequest:
      type: object
      required: [agentId, intentId, action]
      properties:
        agentId:
          type: string
        intentId:
          type: string
        action:
          type: string
          enum: [approve, cancel, settle_request]
        reasonCode:
          type: string
        reasonMessage:
          type: string
    ManagementSessionSelectRequest:
      type: object
      required: [agentId, token]
      properties:
        agentId:
          type: string
        token:
          type: string
    CopySubscriptionCreateRequest:
      type: object
      required: [leaderAgentId, followerAgentId, enabled, scaleBps, maxTradeUsd]
      properties:
        leaderAgentId:
          type: string
        followerAgentId:
          type: string
        enabled:
          type: boolean
        scaleBps:
          type: integer
          minimum: 1
          maximum: 100000
        maxTradeUsd:
          type: string
          pattern: '^[0-9]+(\.[0-9]{1,8})?$'
        allowedTokens:
          type: array
          maxItems: 64
          uniqueItems: true
          items:
            type: string
            pattern: '^0x[a-fA-F0-9]{40}$'
    CopySubscriptionPatchRequest:
      type: object
      minProperties: 1
      properties:
        enabled:
          type: boolean
        scaleBps:
          type: integer
          minimum: 1
          maximum: 100000
        maxTradeUsd:
          type: string
          pattern: '^[0-9]+(\.[0-9]{1,8})?$'
        allowedTokens:
          type: array
          maxItems: 64
          uniqueItems: true
          items:
            type: string
            pattern: '^0x[a-fA-F0-9]{40}$'
    OffdexIntentCreateRequest:
      type: object
      required: [schemaVersion, chainKey, makerAgentId, makerWalletAddress, makerToken, takerToken, makerAmount, takerAmount, escrowContract, expiresAt]
      properties:
        schemaVersion:
          type: integer
          minimum: 1
        chainKey:
          type: string
        makerAgentId:
          type: string
        takerAgentId:
          type: string
        makerWalletAddress:
          type: string
        makerToken:
          type: string
        takerToken:
          type: string
        makerAmount:
          type: string
        takerAmount:
          type: string
        escrowContract:
          type: string
        expiresAt:
          type: string
          format: date-time
    OffdexStatusUpdateRequest:
      type: object
      required: [status, at]
      properties:
        status:
          type: string
          enum: [proposed, accepted, maker_funded, taker_funded, ready_to_settle, settling, settled, cancelled, expired, failed]
        failureCode:
          type: string
        failureMessage:
          type: string
        makerFundTxHash:
          type: string
        takerFundTxHash:
          type: string
        settlementTxHash:
          type: string
        escrowDealId:
          type: string
        at:
          type: string
          format: date-time
