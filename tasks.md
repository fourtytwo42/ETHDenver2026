# Slice 23 Tasks: Agent Spot Swap (Token->Token via Configured Router)

Active slice: `Slice 23: Agent Spot Swap Command (Token->Token via Configured Router)`

## Checklist
- [x] Add runtime command `xclaw-agent trade spot`.
- [x] Use router `getAmountsOut` to compute net quote and apply slippage-bps to produce `amountOutMin`.
- [x] Submit `swapExactTokensForTokens` to `coreContracts.router` (fee proxy compatible).
- [x] Skill wrapper command `trade-spot <token_in> <token_out> <amount_in> <slippage_bps>`.
- [x] Tests: spot swap success call-shape + invalid input.
- [x] Docs sync: source-of-truth + skill references + tracker/roadmap.
- [x] Run required gates and capture evidence in `acceptance.md`.

---

# Slice 25 Tasks: Agent Skill UX Upgrade (Security + Reliability + Contract Fixes)

Active slice: `Slice 25: Agent Skill UX Upgrade (Security + Reliability + Contract Fixes)`

## Checklist
- [x] Add Slice 25 to `docs/XCLAW_SLICE_TRACKER.md` + `docs/XCLAW_BUILD_ROADMAP.md`.
- [x] Update `docs/XCLAW_SOURCE_OF_TRUTH.md` for:
  - [x] sensitive stdout redaction rule
  - [x] faucet pending guidance fields
- [x] Skill wrapper:
  - [x] redact `sensitiveFields` by default
  - [x] document `XCLAW_SHOW_SENSITIVE=1`
- [x] Runtime:
  - [x] faucet includes `pending`, `recommendedDelaySec`, `nextAction`
  - [x] limit-orders-create omits `expiresAt` unless provided
  - [x] surface server validation details in `details.apiDetails`
- [x] Server UX hint:
  - [x] update limit-orders schema error `actionHint` copy (remove outdated "pair fields")
- [x] Tests:
  - [x] faucet success asserts pending guidance fields
  - [x] limit-orders-create omits `expiresAt` when missing
  - [x] limit-orders-create failure surfaces server details
- [x] Run gates: `db:parity`, `seed:reset`, `seed:load`, `seed:verify`, `build`.
- [x] Run runtime tests.
- [x] Post evidence + commit hash to GitHub issue #20.

---

# Slice 26 Tasks: Agent Skill Robustness Hardening (Timeouts + Identity + Single-JSON)

Active slice: `Slice 26: Agent Skill Robustness Hardening (Timeouts + Identity + Single-JSON)`

## Checklist
- [x] Create and map issue: #21.
- [x] Wrapper:
  - [x] add `XCLAW_SKILL_TIMEOUT_SEC` handling (default 240)
  - [x] return structured `timeout` JSON on expiration
- [x] Runtime:
  - [x] add cast timeout envs (`XCLAW_CAST_CALL_TIMEOUT_SEC`, `XCLAW_CAST_RECEIPT_TIMEOUT_SEC`, `XCLAW_CAST_SEND_TIMEOUT_SEC`)
  - [x] centralize subprocess timeout handling
  - [x] `trade-spot` maps timeout failures to actionable codes
- [x] UX payloads:
  - [x] `status` includes best-effort `agentName` and warnings
  - [x] `wallet-health` includes `nextAction` + `actionHint`
  - [x] `faucet-request` surfaces `retryAfterSec` on rate limit
  - [x] `limit-orders-run-loop` emits single JSON; reject `--iterations 0` in JSON mode
  - [x] `trade-spot` includes `totalGasCostEthExact` + `totalGasCostEthPretty`
- [x] Tests:
  - [x] `test_trade_path` updates for status/faucet/run-loop behavior
  - [x] wallet-health guidance test added
- [x] Docs sync:
  - [x] `docs/XCLAW_SOURCE_OF_TRUTH.md`
  - [x] `docs/XCLAW_SLICE_TRACKER.md`
  - [x] `docs/XCLAW_BUILD_ROADMAP.md`
  - [x] `docs/api/WALLET_COMMAND_CONTRACT.md`
  - [x] `skills/xclaw-agent/SKILL.md`
  - [x] `docs/CONTEXT_PACK.md`, `spec.md`, `tasks.md`, `acceptance.md`
- [x] Run all required gates (`db:parity`, `seed:reset`, `seed:load`, `seed:verify`, `build`) and record evidence.
- [x] Run Slice 26 runtime tests (`test_trade_path` full + wallet-health guidance targeted).
- [x] Capture environment-dependent smoke outcomes (wrapper commands) with explicit blocker evidence.
- [x] Commit/push Slice 26 close-out and post verification evidence + commit hash to issue #21.

## Management incident follow-up checklist (2026-02-14)
- [x] Update management bootstrap API error guidance for one-time/host-scoped behavior.
- [x] Improve `/agents/:id` unauthorized + bootstrap-failure UX copy with actionable host guidance.
- [x] Add static asset integrity verifier script (`infrastructure/scripts/ops/verify-static-assets.sh`).
- [x] Update ops runbook with purge/warm + verifier sequence.
- [x] Update source-of-truth/roadmap/tracker notes for management host + asset guardrails.
- [x] Run mandatory gates (`db:parity`, `seed:reset`, `seed:load`, `seed:verify`, `build`).
- [x] Run targeted runtime test for management-link host normalization.
- [x] Run static verifier against production and capture blocker output.

## Management incident gate hardening checklist (2026-02-14)
- [x] Add release-gate npm command for static verification (`npm run ops:verify-static-assets`).
- [x] Update runbook to use release-gate command and mark as blocking.
- [x] Update roadmap/tracker notes for release-gate command availability.
- [x] Re-run release-gate command against production and capture current blocker evidence.

## Agent sync-delay UX refinement checklist (2026-02-14)
- [x] Add `last_heartbeat_at` to public agents/profile API payloads.
- [x] Switch `/agents` and `/agents/:id` stale detection to heartbeat-based logic.
- [x] Increase stale/offline threshold from 60s to 180s for UI + ops heartbeat-miss summary.
- [x] Update source-of-truth to reflect heartbeat-based stale semantics and 180s threshold.
- [x] Run required gates and verify production static asset gate remains green.

---

# Slice 27 Tasks: Responsive + Multi-Viewport UI Fit (Phone + Tall + Wide)

Active slice: `Slice 27: Responsive + Multi-Viewport UI Fit (Phone + Tall + Wide)`
Issue mapping: `#22`

## Checklist
- [x] Create and map issue #22 for Slice 27.
- [x] Pre-flight lock: objective + acceptance checks + touched-file allowlist defined before edits.
- [x] Docs sync before UI edits:
  - [x] `docs/XCLAW_SLICE_TRACKER.md`
  - [x] `docs/XCLAW_BUILD_ROADMAP.md`
  - [x] `docs/XCLAW_SOURCE_OF_TRUTH.md`
- [x] `docs/CONTEXT_PACK.md`
- [x] `spec.md`
- [x] `tasks.md`
- [x] Global responsive foundation in `apps/network-web/src/app/globals.css`.
- [x] Update shell/header layout in `apps/network-web/src/components/public-shell.tsx`.
- [x] Dashboard (`/`) responsive table/card split and layout updates.
- [x] Agents directory (`/agents`) responsive table/card split and mobile filters.
- [x] Agent profile/management (`/agents/:id`) responsive trade cards + management usability improvements.
- [x] Status page (`/status`) mobile/tall/wide readability updates.
- [x] Run required gates:
  - [x] `npm run db:parity`
  - [x] `npm run seed:reset`
  - [x] `npm run seed:load`
  - [x] `npm run seed:verify`
  - [x] `npm run build`
- [x] Record viewport verification matrix in `acceptance.md`.
- [x] Mark Slice 27 tracker/roadmap DoD complete.
- [x] Commit + push Slice 27.
- [x] Post verification evidence + commit hash(es) to issue #22.

---

# Slice 28 Tasks: Mock Mode Deprecation (Network-Only User Surface, Base Sepolia)

Active slice: `Slice 28: Mock Mode Deprecation (Network-Only User Surface, Base Sepolia)`
Issue mapping: `#23`

## Checklist
- [x] Create and map issue #23 for Slice 28.
- [x] Pre-flight lock: objective + acceptance checks + touched-file allowlist defined before edits.
- [x] Docs sync before implementation:
  - [x] `docs/XCLAW_SLICE_TRACKER.md`
  - [x] `docs/XCLAW_BUILD_ROADMAP.md`
  - [x] `docs/XCLAW_SOURCE_OF_TRUTH.md`
  - [x] `docs/api/openapi.v1.yaml`
  - [x] `docs/CONTEXT_PACK.md`
  - [x] `spec.md`
  - [x] `tasks.md`
- [x] Remove mode controls/mock wording from web user-facing pages.
- [x] Public API read routes coerce mode compatibility to network/real-only outputs.
- [x] Agent runtime + skill reject mode=mock with structured unsupported_mode errors.
- [x] Update skill docs/references + hosted skill/install copy to network-only wording.
- [ ] Run required gates:
  - [x] `npm run db:parity`
  - [x] `npm run seed:reset`
  - [x] `npm run seed:load`
  - [x] `npm run seed:verify`
  - [x] `npm run build`
  - [x] `python3 -m unittest apps/agent-runtime/tests/test_trade_path.py -v`
- [x] Run grep evidence command for user-facing mock removal.
- [x] Record evidence in `acceptance.md`.
- [x] Mark Slice 28 tracker/roadmap DoD complete.
- [x] Commit + push Slice 28.
- [x] Post verification evidence + commit hash(es) to issue #23.

---

# Slice 29 Tasks: Dashboard Chain-Scoped UX + Activity Detail + Chat-Style Room

Active slice: `Slice 29: Dashboard Chain-Scoped UX + Activity Detail + Chat-Style Room`
Issue mapping: `#24`

## Checklist
- [x] Create and map issue #24 for Slice 29.
- [x] Pre-flight lock: objective + acceptance checks + touched-file allowlist defined before edits.
- [x] Docs sync before implementation:
  - [x] `docs/XCLAW_SLICE_TRACKER.md`
  - [x] `docs/XCLAW_BUILD_ROADMAP.md`
  - [x] `docs/XCLAW_SOURCE_OF_TRUTH.md`
  - [x] `docs/CONTEXT_PACK.md`
  - [x] `spec.md`
  - [x] `tasks.md`
- [x] Dashboard removes redundant chain chip/name text.
- [x] Trade room + live activity are filtered to active chain (`base_sepolia`) on dashboard.
- [x] Public activity payload includes optional trade detail fields for UI display (`pair` or `token_in -> token_out`).
- [x] Trade room adopts chat-style message card rendering.
- [x] Run required gates:
  - [x] `npm run db:parity`
  - [x] `npm run seed:reset`
  - [x] `npm run seed:load`
  - [x] `npm run seed:verify`
  - [x] `npm run build`
- [x] Record evidence in `acceptance.md`.
- [x] Mark Slice 29 tracker/roadmap DoD complete.
- [x] Commit + push Slice 29.
- [x] Post verification evidence + commit hash(es) to issue #24.

---

# Slice 33 Tasks: MetaMask-Like Agent Wallet UX + Simplified Approvals (Global + Per-Token)

Active slice: `Slice 33: MetaMask-Like Agent Wallet UX + Simplified Approvals (Global + Per-Token)`

## Checklist
- [ ] Docs sync first:
  - [ ] `docs/XCLAW_SLICE_TRACKER.md`
  - [ ] `docs/XCLAW_BUILD_ROADMAP.md`
  - [ ] `docs/XCLAW_SOURCE_OF_TRUTH.md`
  - [ ] `docs/api/openapi.v1.yaml`
  - [ ] `docs/CONTEXT_PACK.md`
  - [ ] `spec.md`
  - [ ] `tasks.md`
  - [ ] `acceptance.md`
- [ ] Deprecate legacy approval scopes:
  - [ ] UI removes any pair/global scope controls.
  - [ ] `POST /api/v1/management/approvals/scope` returns structured deprecation response (410) and is not used by UI.
- [ ] Server: trade proposal assigns initial approval state:
  - [ ] `POST /api/v1/trades/proposed` sets initial `trades.status` to `approved|approval_pending` based on:
    - [ ] Global Approval ON (`approval_mode=auto`) => `approved`
    - [ ] Global OFF and `tokenIn` preapproved (`allowed_tokens`) => `approved`
    - [ ] otherwise => `approval_pending`
  - [ ] `agent_events` uses `trade_approved` or `trade_approval_pending` for the initial event.
- [ ] Server: copy lifecycle aligns with simplified approvals:
  - [ ] follower trade status uses the same global/tokenIn gating
  - [ ] follower policy no longer rejects due to `allowed_tokens` mismatch (treated as preapproval, not allowlist)
- [ ] Runtime: server-first `trade spot`:
  - [ ] proposes to server before any on-chain tx
  - [ ] waits/polls if `approval_pending`
  - [ ] executes only if approved and posts status transitions
  - [ ] surfaces rejection reason on deny (`reasonCode/reasonMessage`)
- [ ] `/agents/:id` UX:
  - [ ] Wallet-first header (copyable address pill)
  - [ ] Assets list (MetaMask-like rows with icon placeholders)
  - [ ] Unified Activity feed (trades + events) in MetaMask-style list
  - [ ] Owner-only approvals panel supports reject reason message
  - [ ] Owner-only policy panel has Global Approval toggle + per-token preapproval toggles
- [ ] Gates:
  - [ ] `npm run db:parity`
  - [ ] `npm run seed:reset`
  - [ ] `npm run seed:load`
  - [ ] `npm run seed:verify`
  - [ ] `npm run build`
  - [ ] `python3 -m unittest apps/agent-runtime/tests/test_trade_path.py -v`

---

# Slice 32 Tasks: Per-Agent Chain Enable/Disable (Owner-Gated, Chain-Scoped Ops)

Active slice: `Slice 32: Per-Agent Chain Enable/Disable (Owner-Gated, Chain-Scoped Ops)`

## Checklist
- [x] Docs sync first:
  - [x] `docs/XCLAW_SLICE_TRACKER.md`
  - [x] `docs/XCLAW_BUILD_ROADMAP.md`
  - [x] `docs/XCLAW_SOURCE_OF_TRUTH.md`
  - [x] `docs/api/openapi.v1.yaml`
  - [x] `docs/api/WALLET_COMMAND_CONTRACT.md`
  - [x] `docs/CONTEXT_PACK.md`
  - [x] `spec.md`
  - [x] `tasks.md`
  - [x] `acceptance.md`
- [x] Migration:
  - [x] add `infrastructure/migrations/0009_slice32_agent_chain_enable.sql` (`agent_chain_policies`)
- [x] API:
  - [x] add `POST /api/v1/management/chains/update`
  - [x] extend `GET /api/v1/management/agent-state` with optional `chainKey` and `chainPolicy` response
  - [x] extend `GET /api/v1/agent/transfers/policy` with `chainEnabled` fields
- [x] Server enforcement:
  - [x] block `POST /api/v1/trades/proposed` when chain disabled
  - [x] block `POST /api/v1/trades/:tradeId/status` execution transitions when chain disabled
  - [x] block `POST /api/v1/limit-orders` create when chain disabled
  - [x] block limit-order status `triggered|filled` when chain disabled
- [x] Runtime enforcement:
  - [x] block trade and `wallet-send` when owner chain access is disabled (`chainEnabled == false`)
  - [x] add unit tests for owner chain disabled enforcement
- [x] UI:
  - [x] `/agents/:id` shows “Chain Access” toggle for active chain context; enabling requires step-up
- [x] Gates:
  - [x] `npm run db:parity`
  - [x] `npm run seed:reset`
  - [x] `npm run seed:load`
  - [x] `npm run seed:verify`
  - [x] `npm run build`
  - [x] `python3 -m unittest apps/agent-runtime/tests/test_trade_path.py -v`

---

# Slice 30 Tasks: Owner-Managed Daily Trade Caps + Usage Visibility (Trades Only)

Active slice: `Slice 30: Owner-Managed Daily Trade Caps + Usage Visibility (Trades Only)`

## Checklist
- [x] Add Slice 30 tracker + roadmap entries.
- [x] Add migration: policy cap fields + `agent_daily_trade_usage` table.
- [x] Extend management policy schema with cap toggles/count.
- [x] Add agent trade usage request schema.
- [x] Implement `POST /api/v1/agent/trade-usage` (agent auth + idempotency).
- [x] Extend `GET /api/v1/agent/transfers/policy` with trade caps + UTC-day usage.
- [x] Extend `GET /api/v1/management/agent-state` with trade caps + UTC-day usage.
- [x] Persist cap fields in `POST /api/v1/management/policy/update`.
- [x] Add server-side cap checks for proposed/create/filled trade write paths.
- [x] Add runtime cap checks for spot/execute/limit-order-fill trade actions.
- [x] Add runtime usage report queue/replay path.
- [x] Update `/agents/:id` management rail with cap toggles/values + usage progress.
- [x] Sync source-of-truth/openapi/context/spec/tasks/acceptance artifacts.
- [x] Run required gates and capture evidence in `acceptance.md`.

---

# Slice 31 Tasks: Agents + Agent Management UX Refinement (Operational Clean)

Active slice: `Slice 31: Agents + Agent Management UX Refinement (Operational Clean)`

## Checklist
- [x] Add Slice 31 tracker + roadmap entries.
- [x] Update source-of-truth with Slice 31 locked UX/API refinements.
- [x] Extend `GET /api/v1/public/agents` with optional `includeMetrics` response enrichment.
- [x] Extend `GET /api/v1/public/activity` with optional `agentId` filter.
- [x] Refine `/agents` to card-first layout with KPI summaries and optional desktop table.
- [x] Refine `/agents/:id` public sections (overview/trades/activity readability and copy).
- [x] Re-group `/agents/:id` management rail into operational order.
- [x] Add progressive disclosure for advanced management sections.
- [x] Preserve Slice 30 cap controls/usage visibility and existing management actions.
- [x] Sync openapi/context/spec/tasks/acceptance artifacts.
- [x] Run required gates and capture evidence in `acceptance.md`.
