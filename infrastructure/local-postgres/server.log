2026-02-13 05:27:17.693 UTC [235859] LOG:  starting PostgreSQL 17.7 (Ubuntu 17.7-0ubuntu0.25.10.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 15.2.0-4ubuntu4) 15.2.0, 64-bit
2026-02-13 05:27:17.693 UTC [235859] LOG:  listening on IPv4 address "127.0.0.1", port 55432
2026-02-13 05:27:17.699 UTC [235859] FATAL:  could not create lock file "/var/run/postgresql/.s.PGSQL.55432.lock": Permission denied
2026-02-13 05:27:17.700 UTC [235859] LOG:  database system is shut down
2026-02-13 05:27:24.613 UTC [235919] LOG:  starting PostgreSQL 17.7 (Ubuntu 17.7-0ubuntu0.25.10.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 15.2.0-4ubuntu4) 15.2.0, 64-bit
2026-02-13 05:27:24.613 UTC [235919] LOG:  listening on IPv4 address "127.0.0.1", port 55432
2026-02-13 05:27:24.687 UTC [235919] LOG:  listening on Unix socket "/home/hendo420/ETHDenver2026/infrastructure/local-postgres/socket/.s.PGSQL.55432"
2026-02-13 05:27:24.754 UTC [235923] LOG:  database system was shut down at 2026-02-13 05:27:14 UTC
2026-02-13 05:27:24.843 UTC [235919] LOG:  database system is ready to accept connections
2026-02-13 05:27:25.952 UTC [235935] FATAL:  database "hendo420" does not exist
2026-02-13 05:27:32.033 UTC [235974] ERROR:  syntax error at or near "window" at character 140
2026-02-13 05:27:32.033 UTC [235974] STATEMENT:  create table if not exists performance_snapshots (
	  snapshot_id text primary key,
	  agent_id text not null references agents(agent_id),
	  window performance_window not null,
	  pnl_usd numeric,
	  return_pct numeric,
	  volume_usd numeric,
	  win_rate_pct numeric,
	  trades_count int not null default 0,
	  followers_count int not null default 0,
	  created_at timestamptz not null default now()
	);
2026-02-13 05:27:57.703 UTC [235921] LOG:  checkpoint starting: immediate force wait
2026-02-13 05:27:57.750 UTC [235921] LOG:  checkpoint complete: wrote 15 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.014 s, sync=0.011 s, total=0.048 s; sync files=12, longest=0.007 s, average=0.001 s; distance=4483 kB, estimate=4483 kB; lsn=0/194DA10, redo lsn=0/194D9B8
2026-02-13 05:32:57.764 UTC [235921] LOG:  checkpoint starting: time
2026-02-13 05:33:03.822 UTC [239112] ERROR:  inconsistent types deduced for parameter $1 at character 55
2026-02-13 05:33:03.822 UTC [239112] DETAIL:  text versus trade_status
2026-02-13 05:33:03.822 UTC [239112] STATEMENT:  
	        update trades
	        set
	          status = $1,
	          reason_code = $2,
	          reason_message = $3,
	          tx_hash = coalesce($4, tx_hash),
	          mock_receipt_id = coalesce($5, mock_receipt_id),
	          error_message = coalesce($6, error_message),
	          executed_at = case when $1 in ('filled', 'failed') then $7::timestamptz else executed_at end,
	          updated_at = now()
	        where trade_id = $8
	        
2026-02-13 05:33:32.128 UTC [239788] ERROR:  inconsistent types deduced for parameter $1 at character 55
2026-02-13 05:33:32.128 UTC [239788] DETAIL:  text versus trade_status
2026-02-13 05:33:32.128 UTC [239788] STATEMENT:  
	        update trades
	        set
	          status = $1,
	          reason_code = $2,
	          reason_message = $3,
	          tx_hash = coalesce($4, tx_hash),
	          mock_receipt_id = coalesce($5, mock_receipt_id),
	          error_message = coalesce($6, error_message),
	          executed_at = case when $1 in ('filled', 'failed') then $7::timestamptz else executed_at end,
	          updated_at = now()
	        where trade_id = $8
	        
2026-02-13 05:34:41.960 UTC [235921] LOG:  checkpoint complete: wrote 1042 buffers (6.4%); 1 WAL file(s) added, 0 removed, 0 recycled; write=104.126 s, sync=0.015 s, total=104.197 s; sync files=395, longest=0.008 s, average=0.001 s; distance=5136 kB, estimate=5136 kB; lsn=0/1E545C0, redo lsn=0/1E51CA0
2026-02-13 05:57:58.262 UTC [235921] LOG:  checkpoint starting: time
2026-02-13 05:58:01.920 UTC [235921] LOG:  checkpoint complete: wrote 37 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=3.620 s, sync=0.012 s, total=3.659 s; sync files=25, longest=0.008 s, average=0.001 s; distance=20 kB, estimate=4625 kB; lsn=0/1E56EC8, redo lsn=0/1E56E70
2026-02-13 06:52:59.571 UTC [235921] LOG:  checkpoint starting: time
2026-02-13 06:53:03.910 UTC [235921] LOG:  checkpoint complete: wrote 43 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=4.223 s, sync=0.043 s, total=4.340 s; sync files=39, longest=0.023 s, average=0.002 s; distance=36 kB, estimate=4166 kB; lsn=0/1E60150, redo lsn=0/1E600F8
2026-02-13 16:13:50.900 UTC [9393] LOG:  starting PostgreSQL 17.7 (Ubuntu 17.7-0ubuntu0.25.10.1) on x86_64-pc-linux-gnu, compiled by gcc (Ubuntu 15.2.0-4ubuntu4) 15.2.0, 64-bit
2026-02-13 16:13:50.900 UTC [9393] LOG:  listening on IPv4 address "127.0.0.1", port 55432
2026-02-13 16:13:50.911 UTC [9393] LOG:  listening on Unix socket "/home/hendo420/ETHDenver2026/infrastructure/local-postgres/socket/.s.PGSQL.55432"
2026-02-13 16:13:50.923 UTC [9396] LOG:  database system was interrupted; last known up at 2026-02-13 06:53:03 UTC
2026-02-13 16:13:50.955 UTC [9396] LOG:  database system was not properly shut down; automatic recovery in progress
2026-02-13 16:13:50.963 UTC [9396] LOG:  redo starts at 0/1E600F8
2026-02-13 16:13:50.964 UTC [9396] LOG:  invalid record length at 0/1E60200: expected at least 24, got 0
2026-02-13 16:13:50.964 UTC [9396] LOG:  redo done at 0/1E601C8 system usage: CPU: user: 0.00 s, system: 0.00 s, elapsed: 0.00 s
2026-02-13 16:13:50.975 UTC [9394] LOG:  checkpoint starting: end-of-recovery immediate wait
2026-02-13 16:13:51.012 UTC [9394] LOG:  checkpoint complete: wrote 3 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.011 s, sync=0.004 s, total=0.043 s; sync files=2, longest=0.003 s, average=0.002 s; distance=0 kB, estimate=0 kB; lsn=0/1E60200, redo lsn=0/1E60200
2026-02-13 16:13:51.019 UTC [9393] LOG:  database system is ready to accept connections
2026-02-13 16:15:15.893 UTC [10296] ERROR:  new row for relation "trades" violates check constraint "trade_execution_id_check"
2026-02-13 16:15:15.893 UTC [10296] DETAIL:  Failing row contains (trd_39b55a8c132b9b9ba30f, ag_slice7, hardhat_local, f, executing, 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9, 0x5FC8d32690cc91D4c39d9d3abcBD16989F875707, 0xDc64a140Aa3E981100a9becA4E685f962f0cF6C9/0x5FC8d32690cc91D4c39..., 1000000000000000, null, null, 50, null, null, null, null, null, null, null, null, 2026-02-13 16:14:08.074837+00, 2026-02-13 16:15:15.892908+00).
2026-02-13 16:15:15.893 UTC [10296] STATEMENT:  
	        update trades
	        set
	          status = $1::trade_status,
	          reason_code = $2,
	          reason_message = $3,
	          tx_hash = coalesce($4, tx_hash),
	          mock_receipt_id = coalesce($5, mock_receipt_id),
	          error_message = coalesce($6, error_message),
	          executed_at = case when $1::trade_status in ('filled', 'failed') then $7::timestamptz else executed_at end,
	          updated_at = now()
	        where trade_id = $8
	        
2026-02-13 16:18:50.020 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 16:18:51.178 UTC [9394] LOG:  checkpoint complete: wrote 14 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.118 s, sync=0.017 s, total=1.159 s; sync files=14, longest=0.008 s, average=0.002 s; distance=23 kB, estimate=23 kB; lsn=0/1E65FD8, redo lsn=0/1E65F80
2026-02-13 16:23:50.195 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 16:23:50.634 UTC [9394] LOG:  checkpoint complete: wrote 5 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.407 s, sync=0.009 s, total=0.439 s; sync files=5, longest=0.006 s, average=0.002 s; distance=9 kB, estimate=21 kB; lsn=0/1E68570, redo lsn=0/1E68518
2026-02-13 16:43:50.854 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 16:43:53.003 UTC [9394] LOG:  checkpoint complete: wrote 22 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=2.114 s, sync=0.011 s, total=2.149 s; sync files=21, longest=0.007 s, average=0.001 s; distance=42 kB, estimate=42 kB; lsn=0/1E72DB8, redo lsn=0/1E72D60
2026-02-13 16:48:50.021 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 16:48:51.163 UTC [9394] LOG:  checkpoint complete: wrote 12 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.108 s, sync=0.010 s, total=1.142 s; sync files=12, longest=0.008 s, average=0.001 s; distance=25 kB, estimate=40 kB; lsn=0/1E79280, redo lsn=0/1E79228
2026-02-13 17:05:50.130 UTC [32912] ERROR:  new row for relation "trades" violates check constraint "trade_execution_id_check"
2026-02-13 17:05:50.130 UTC [32912] DETAIL:  Failing row contains (trd_df9b94c19e16d42af33f, ag_leader13, base_sepolia, f, executing, 0xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa, 0xbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbbb, 0xaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa/0xbbbbbbbbbbbbbbbbbbb..., 50, 52, null, 50, slice13-copy-test, null, null, null, null, null, null, null, 2026-02-13 17:05:43.53029+00, 2026-02-13 17:05:50.12837+00).
2026-02-13 17:05:50.130 UTC [32912] STATEMENT:  
	        update trades
	        set
	          status = $1::trade_status,
	          reason_code = $2,
	          reason_message = $3,
	          tx_hash = coalesce($4, tx_hash),
	          mock_receipt_id = coalesce($5, mock_receipt_id),
	          error_message = coalesce($6, error_message),
	          executed_at = case when $1::trade_status in ('filled', 'failed') then $7::timestamptz else executed_at end,
	          updated_at = now()
	        where trade_id = $8
	        
2026-02-13 17:07:32.514 UTC [33902] ERROR:  inconsistent types deduced for parameter $1 at character 49
2026-02-13 17:07:32.514 UTC [33902] DETAIL:  text versus character varying
2026-02-13 17:07:32.514 UTC [33902] STATEMENT:  
	    update copy_intents
	    set
	      status = $1,
	      rejection_code = case when $1 = 'rejected' then coalesce($2, rejection_code) else rejection_code end,
	      rejection_message = case when $1 = 'rejected' then coalesce($3, rejection_message) else rejection_message end,
	      updated_at = now()
	    where follower_trade_id = $4
	    returning follower_agent_id, leader_agent_id
	    
2026-02-13 17:08:42.338 UTC [34381] ERROR:  syntax error at or near "window" at character 812
2026-02-13 17:08:42.338 UTC [34381] STATEMENT:  
	      with ranked as (
	        select
	          mode,
	          "window" as window,
	          chain_key,
	          score::text,
	          pnl_usd::text,
	          return_pct::text,
	          volume_usd::text,
	          trades_count,
	          followers_count,
	          self_trades_count,
	          copied_trades_count,
	          self_volume_usd::text,
	          copied_volume_usd::text,
	          self_pnl_usd::text,
	          copied_pnl_usd::text,
	          stale,
	          degraded_reason,
	          created_at::text,
	          row_number() over (partition by mode, "window", chain_key order by created_at desc) as rn
	        from performance_snapshots
	        where agent_id = $1
	          and "window" = '7d'::performance_window
	          and chain_key = 'all'
	      )
	      select
	        mode,
	        window,
	        chain_key,
	        score,
	        pnl_usd,
	        return_pct,
	        volume_usd,
	        trades_count,
	        followers_count,
	        self_trades_count,
	        copied_trades_count,
	        self_volume_usd,
	        copied_volume_usd,
	        self_pnl_usd,
	        copied_pnl_usd,
	        stale,
	        degraded_reason,
	        created_at
	      from ranked
	      where rn = 1
	      order by mode asc
	      
2026-02-13 17:08:48.731 UTC [34486] ERROR:  syntax error at or near "window" at character 17
2026-02-13 17:08:48.731 UTC [34486] STATEMENT:  select agent_id,window,mode,chain_key,trades_count,self_trades_count,copied_trades_count,created_at from performance_snapshots where agent_id in ('ag_leader13','ag_follower13') order by created_at desc limit 20;
2026-02-13 17:08:50.426 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 17:08:59.909 UTC [9394] LOG:  checkpoint complete: wrote 95 buffers (0.6%); 0 WAL file(s) added, 0 removed, 0 recycled; write=9.429 s, sync=0.027 s, total=9.483 s; sync files=67, longest=0.006 s, average=0.001 s; distance=310 kB, estimate=310 kB; lsn=0/1ECFF38, redo lsn=0/1EC6D40
2026-02-13 17:10:57.180 UTC [35429] ERROR:  inconsistent types deduced for parameter $1 at character 49
2026-02-13 17:10:57.180 UTC [35429] DETAIL:  text versus character varying
2026-02-13 17:10:57.180 UTC [35429] STATEMENT:  
	    update copy_intents
	    set
	      status = $1,
	      rejection_code = case when $1 = 'rejected' then coalesce($2, rejection_code) else rejection_code end,
	      rejection_message = case when $1 = 'rejected' then coalesce($3, rejection_message) else rejection_message end,
	      updated_at = now()
	    where follower_trade_id = $4
	    returning follower_agent_id, leader_agent_id
	    
2026-02-13 17:11:17.545 UTC [35673] ERROR:  inconsistent types deduced for parameter $1 at character 49
2026-02-13 17:11:17.545 UTC [35673] DETAIL:  text versus character varying
2026-02-13 17:11:17.545 UTC [35673] STATEMENT:  
	    update copy_intents
	    set
	      status = $1,
	      rejection_code = case when $1 = 'rejected' then coalesce($2, rejection_code) else rejection_code end,
	      rejection_message = case when $1 = 'rejected' then coalesce($3, rejection_message) else rejection_message end,
	      updated_at = now()
	    where follower_trade_id = $4
	    returning follower_agent_id, leader_agent_id
	    
2026-02-13 17:13:50.960 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 17:13:54.011 UTC [9394] LOG:  checkpoint complete: wrote 31 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=3.013 s, sync=0.011 s, total=3.051 s; sync files=25, longest=0.008 s, average=0.001 s; distance=146 kB, estimate=294 kB; lsn=0/1EEB8D0, redo lsn=0/1EEB878
2026-02-13 17:31:39.630 UTC [44201] ERROR:  type "agent_event_type" already exists
2026-02-13 17:31:39.630 UTC [44201] STATEMENT:  CREATE TYPE public.agent_event_type AS ENUM (
	    'heartbeat',
	    'trade_proposed',
	    'trade_approval_pending',
	    'trade_approved',
	    'trade_rejected',
	    'trade_executing',
	    'trade_verifying',
	    'trade_filled',
	    'trade_failed',
	    'trade_expired',
	    'trade_verification_timeout',
	    'policy_changed'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "approval_scope" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.approval_scope AS ENUM (
	    'trade',
	    'pair',
	    'global'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "approval_status" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.approval_status AS ENUM (
	    'active',
	    'revoked',
	    'expired',
	    'consumed'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "custody_type" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.custody_type AS ENUM (
	    'agent_local'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "management_action_status" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.management_action_status AS ENUM (
	    'accepted',
	    'rejected',
	    'failed'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "management_token_status" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.management_token_status AS ENUM (
	    'active',
	    'rotated',
	    'revoked'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "offdex_settlement_status" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.offdex_settlement_status AS ENUM (
	    'proposed',
	    'accepted',
	    'maker_funded',
	    'taker_funded',
	    'ready_to_settle',
	    'settling',
	    'settled',
	    'cancelled',
	    'expired',
	    'failed'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "performance_window" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.performance_window AS ENUM (
	    '24h',
	    '7d',
	    '30d',
	    'all'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "policy_approval_mode" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.policy_approval_mode AS ENUM (
	    'per_trade',
	    'auto'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "policy_mode" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.policy_mode AS ENUM (
	    'mock',
	    'real'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "public_status" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.public_status AS ENUM (
	    'active',
	    'offline',
	    'degraded',
	    'paused',
	    'deactivated'
	);
2026-02-13 17:31:39.631 UTC [44201] ERROR:  type "runtime_platform" already exists
2026-02-13 17:31:39.631 UTC [44201] STATEMENT:  CREATE TYPE public.runtime_platform AS ENUM (
	    'windows',
	    'linux',
	    'macos'
	);
2026-02-13 17:31:39.632 UTC [44201] ERROR:  type "stepup_issued_for" already exists
2026-02-13 17:31:39.632 UTC [44201] STATEMENT:  CREATE TYPE public.stepup_issued_for AS ENUM (
	    'withdraw',
	    'approval_scope_change',
	    'sensitive_action'
	);
2026-02-13 17:31:39.632 UTC [44201] ERROR:  type "trade_status" already exists
2026-02-13 17:31:39.632 UTC [44201] STATEMENT:  CREATE TYPE public.trade_status AS ENUM (
	    'proposed',
	    'approval_pending',
	    'approved',
	    'rejected',
	    'executing',
	    'verifying',
	    'filled',
	    'failed',
	    'expired',
	    'verification_timeout'
	);
2026-02-13 17:31:39.632 UTC [44201] ERROR:  function "forbid_management_audit_mutation" already exists with same argument types
2026-02-13 17:31:39.632 UTC [44201] STATEMENT:  CREATE FUNCTION public.forbid_management_audit_mutation() RETURNS trigger
	    LANGUAGE plpgsql
	    AS $$
	begin
	  raise exception 'management_audit_log is append-only';
	end;
	$$;
2026-02-13 17:31:39.632 UTC [44201] ERROR:  relation "agent_events" already exists
2026-02-13 17:31:39.632 UTC [44201] STATEMENT:  CREATE TABLE public.agent_events (
	    event_id text NOT NULL,
	    agent_id text NOT NULL,
	    trade_id text,
	    event_type public.agent_event_type NOT NULL,
	    payload jsonb DEFAULT '{}'::jsonb NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.635 UTC [44201] ERROR:  relation "agent_policy_snapshots" already exists
2026-02-13 17:31:39.635 UTC [44201] STATEMENT:  CREATE TABLE public.agent_policy_snapshots (
	    snapshot_id text NOT NULL,
	    agent_id text NOT NULL,
	    mode public.policy_mode NOT NULL,
	    approval_mode public.policy_approval_mode NOT NULL,
	    max_trade_usd numeric,
	    max_daily_usd numeric,
	    allowed_tokens jsonb DEFAULT '[]'::jsonb NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.640 UTC [44201] ERROR:  relation "agent_wallets" already exists
2026-02-13 17:31:39.640 UTC [44201] STATEMENT:  CREATE TABLE public.agent_wallets (
	    wallet_id text NOT NULL,
	    agent_id text NOT NULL,
	    chain_key character varying(64) NOT NULL,
	    address character varying(128) NOT NULL,
	    custody public.custody_type DEFAULT 'agent_local'::public.custody_type NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.643 UTC [44201] ERROR:  relation "agents" already exists
2026-02-13 17:31:39.643 UTC [44201] STATEMENT:  CREATE TABLE public.agents (
	    agent_id text NOT NULL,
	    agent_name character varying(32) NOT NULL,
	    description character varying(280),
	    owner_label character varying(64),
	    runtime_platform public.runtime_platform DEFAULT 'linux'::public.runtime_platform NOT NULL,
	    openclaw_runtime_id character varying(128),
	    openclaw_metadata jsonb DEFAULT '{}'::jsonb NOT NULL,
	    public_status public.public_status DEFAULT 'offline'::public.public_status NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.646 UTC [44201] ERROR:  relation "approvals" already exists
2026-02-13 17:31:39.646 UTC [44201] STATEMENT:  CREATE TABLE public.approvals (
	    approval_id text NOT NULL,
	    agent_id text NOT NULL,
	    chain_key character varying(64) NOT NULL,
	    scope public.approval_scope NOT NULL,
	    status public.approval_status NOT NULL,
	    trade_ref text,
	    pair_ref character varying(128),
	    requires_stepup boolean DEFAULT false NOT NULL,
	    granted_by_session_id text,
	    direction character varying(32) DEFAULT 'non_directional'::character varying NOT NULL,
	    max_amount_usd numeric(18,8) NOT NULL,
	    slippage_bps_max integer NOT NULL,
	    resubmit_window_sec integer DEFAULT 600 NOT NULL,
	    resubmit_amount_tolerance_bps integer DEFAULT 1000 NOT NULL,
	    max_retries integer DEFAULT 3 NOT NULL,
	    expires_at timestamp with time zone NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL,
	    CONSTRAINT approval_scope_ref_check CHECK ((((scope = 'trade'::public.approval_scope) AND (trade_ref IS NOT NULL)) OR ((scope = 'pair'::public.approval_scope) AND (pair_ref IS NOT NULL)) OR ((scope = 'global'::public.approval_scope) AND (trade_ref IS NULL) AND (pair_ref IS NULL))))
	);
2026-02-13 17:31:39.649 UTC [44201] ERROR:  relation "copy_intents" already exists
2026-02-13 17:31:39.649 UTC [44201] STATEMENT:  CREATE TABLE public.copy_intents (
	    intent_id text NOT NULL,
	    leader_agent_id text NOT NULL,
	    follower_agent_id text NOT NULL,
	    source_trade_id text NOT NULL,
	    source_tx_hash character varying(128),
	    mode public.policy_mode NOT NULL,
	    chain_key character varying(64) NOT NULL,
	    pair character varying(128) NOT NULL,
	    token_in character varying(128) NOT NULL,
	    token_out character varying(128) NOT NULL,
	    target_amount_usd numeric NOT NULL,
	    leader_amount_usd numeric NOT NULL,
	    sequence bigint NOT NULL,
	    leader_confirmed_at timestamp with time zone NOT NULL,
	    expires_at timestamp with time zone NOT NULL,
	    status character varying(32) NOT NULL,
	    rejection_code character varying(64),
	    rejection_message text,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    follower_trade_id text,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.652 UTC [44201] ERROR:  relation "copy_subscriptions" already exists
2026-02-13 17:31:39.652 UTC [44201] STATEMENT:  CREATE TABLE public.copy_subscriptions (
	    subscription_id text NOT NULL,
	    leader_agent_id text NOT NULL,
	    follower_agent_id text NOT NULL,
	    enabled boolean DEFAULT true NOT NULL,
	    scale_bps integer DEFAULT 10000 NOT NULL,
	    max_trade_usd numeric,
	    allowed_tokens jsonb,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.655 UTC [44201] ERROR:  relation "management_audit_log" already exists
2026-02-13 17:31:39.655 UTC [44201] STATEMENT:  CREATE TABLE public.management_audit_log (
	    audit_id text NOT NULL,
	    agent_id text NOT NULL,
	    management_session_id text,
	    action_type character varying(64) NOT NULL,
	    action_status public.management_action_status NOT NULL,
	    public_redacted_payload jsonb DEFAULT '{}'::jsonb NOT NULL,
	    private_payload jsonb DEFAULT '{}'::jsonb NOT NULL,
	    user_agent text,
	    created_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.657 UTC [44201] ERROR:  relation "management_sessions" already exists
2026-02-13 17:31:39.657 UTC [44201] STATEMENT:  CREATE TABLE public.management_sessions (
	    session_id text NOT NULL,
	    agent_id text NOT NULL,
	    label character varying(64),
	    cookie_hash character varying(255) NOT NULL,
	    expires_at timestamp with time zone NOT NULL,
	    revoked_at timestamp with time zone,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.660 UTC [44201] ERROR:  relation "management_tokens" already exists
2026-02-13 17:31:39.660 UTC [44201] STATEMENT:  CREATE TABLE public.management_tokens (
	    token_id text NOT NULL,
	    agent_id text NOT NULL,
	    token_ciphertext text NOT NULL,
	    token_fingerprint character varying(128) NOT NULL,
	    status public.management_token_status DEFAULT 'active'::public.management_token_status NOT NULL,
	    rotated_at timestamp with time zone,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.663 UTC [44201] ERROR:  relation "offdex_settlement_intents" already exists
2026-02-13 17:31:39.663 UTC [44201] STATEMENT:  CREATE TABLE public.offdex_settlement_intents (
	    settlement_intent_id text NOT NULL,
	    chain_key character varying(64) NOT NULL,
	    maker_agent_id text NOT NULL,
	    taker_agent_id text,
	    maker_wallet_address character varying(128) NOT NULL,
	    taker_wallet_address character varying(128),
	    maker_token character varying(128) NOT NULL,
	    taker_token character varying(128) NOT NULL,
	    maker_amount numeric NOT NULL,
	    taker_amount numeric NOT NULL,
	    escrow_contract character varying(128) NOT NULL,
	    escrow_deal_id character varying(128),
	    maker_fund_tx_hash character varying(128),
	    taker_fund_tx_hash character varying(128),
	    settlement_tx_hash character varying(128),
	    status public.offdex_settlement_status NOT NULL,
	    failure_code character varying(64),
	    failure_message text,
	    expires_at timestamp with time zone NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.666 UTC [44201] ERROR:  relation "performance_snapshots" already exists
2026-02-13 17:31:39.666 UTC [44201] STATEMENT:  CREATE TABLE public.performance_snapshots (
	    snapshot_id text NOT NULL,
	    agent_id text NOT NULL,
	    "window" public.performance_window NOT NULL,
	    pnl_usd numeric,
	    return_pct numeric,
	    volume_usd numeric,
	    win_rate_pct numeric,
	    trades_count integer DEFAULT 0 NOT NULL,
	    followers_count integer DEFAULT 0 NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    mode public.policy_mode DEFAULT 'mock'::public.policy_mode NOT NULL,
	    chain_key character varying(64) DEFAULT 'all'::character varying NOT NULL,
	    score numeric,
	    self_trades_count integer DEFAULT 0 NOT NULL,
	    copied_trades_count integer DEFAULT 0 NOT NULL,
	    self_volume_usd numeric,
	    copied_volume_usd numeric,
	    self_pnl_usd numeric,
	    copied_pnl_usd numeric,
	    stale boolean DEFAULT false NOT NULL,
	    degraded_reason character varying(64)
	);
2026-02-13 17:31:39.669 UTC [44201] ERROR:  relation "stepup_challenges" already exists
2026-02-13 17:31:39.669 UTC [44201] STATEMENT:  CREATE TABLE public.stepup_challenges (
	    challenge_id text NOT NULL,
	    agent_id text NOT NULL,
	    code_hash character varying(255) NOT NULL,
	    issued_for public.stepup_issued_for NOT NULL,
	    expires_at timestamp with time zone NOT NULL,
	    consumed_at timestamp with time zone,
	    failed_attempts integer DEFAULT 0 NOT NULL,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.671 UTC [44201] ERROR:  relation "stepup_sessions" already exists
2026-02-13 17:31:39.671 UTC [44201] STATEMENT:  CREATE TABLE public.stepup_sessions (
	    stepup_session_id text NOT NULL,
	    agent_id text NOT NULL,
	    management_session_id text NOT NULL,
	    expires_at timestamp with time zone NOT NULL,
	    revoked_at timestamp with time zone,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL
	);
2026-02-13 17:31:39.674 UTC [44201] ERROR:  relation "trades" already exists
2026-02-13 17:31:39.674 UTC [44201] STATEMENT:  CREATE TABLE public.trades (
	    trade_id text NOT NULL,
	    agent_id text NOT NULL,
	    chain_key character varying(64) NOT NULL,
	    is_mock boolean NOT NULL,
	    status public.trade_status NOT NULL,
	    token_in character varying(128) NOT NULL,
	    token_out character varying(128) NOT NULL,
	    pair character varying(128) NOT NULL,
	    amount_in numeric,
	    amount_out numeric,
	    price_impact_bps integer,
	    slippage_bps integer,
	    reason character varying(140),
	    reason_code character varying(64),
	    reason_message text,
	    tx_hash character varying(128),
	    mock_receipt_id character varying(128),
	    error_message text,
	    source_trade_id text,
	    executed_at timestamp with time zone,
	    created_at timestamp with time zone DEFAULT now() NOT NULL,
	    updated_at timestamp with time zone DEFAULT now() NOT NULL,
	    CONSTRAINT trade_execution_id_check CHECK (((tx_hash IS NOT NULL) OR (mock_receipt_id IS NOT NULL) OR (status = ANY (ARRAY['proposed'::public.trade_status, 'approval_pending'::public.trade_status, 'approved'::public.trade_status, 'rejected'::public.trade_status, 'expired'::public.trade_status]))))
	);
2026-02-13 17:31:39.677 UTC [44201] ERROR:  duplicate key value violates unique constraint "agent_events_pkey"
2026-02-13 17:31:39.677 UTC [44201] DETAIL:  Key (event_id)=(evt_4a45b4e128a1e487de4b) already exists.
2026-02-13 17:31:39.677 UTC [44201] CONTEXT:  COPY agent_events, line 1
2026-02-13 17:31:39.677 UTC [44201] STATEMENT:  COPY public.agent_events (event_id, agent_id, trade_id, event_type, payload, created_at) FROM stdin;
2026-02-13 17:31:39.677 UTC [44201] ERROR:  duplicate key value violates unique constraint "agent_policy_snapshots_pkey"
2026-02-13 17:31:39.677 UTC [44201] DETAIL:  Key (snapshot_id)=(aps_719d918390bdf7c2a2dc) already exists.
2026-02-13 17:31:39.677 UTC [44201] CONTEXT:  COPY agent_policy_snapshots, line 1
2026-02-13 17:31:39.677 UTC [44201] STATEMENT:  COPY public.agent_policy_snapshots (snapshot_id, agent_id, mode, approval_mode, max_trade_usd, max_daily_usd, allowed_tokens, created_at) FROM stdin;
2026-02-13 17:31:39.678 UTC [44201] ERROR:  duplicate key value violates unique constraint "agent_wallets_pkey"
2026-02-13 17:31:39.678 UTC [44201] DETAIL:  Key (wallet_id)=(wlt_62b840d6af1d183e9e35) already exists.
2026-02-13 17:31:39.678 UTC [44201] CONTEXT:  COPY agent_wallets, line 1
2026-02-13 17:31:39.678 UTC [44201] STATEMENT:  COPY public.agent_wallets (wallet_id, agent_id, chain_key, address, custody, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.678 UTC [44201] ERROR:  duplicate key value violates unique constraint "agents_pkey"
2026-02-13 17:31:39.678 UTC [44201] DETAIL:  Key (agent_id)=(ag_slice8) already exists.
2026-02-13 17:31:39.678 UTC [44201] CONTEXT:  COPY agents, line 1
2026-02-13 17:31:39.678 UTC [44201] STATEMENT:  COPY public.agents (agent_id, agent_name, description, owner_label, runtime_platform, openclaw_runtime_id, openclaw_metadata, public_status, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.678 UTC [44201] ERROR:  duplicate key value violates unique constraint "copy_intents_pkey"
2026-02-13 17:31:39.678 UTC [44201] DETAIL:  Key (intent_id)=(cpi_64a77de9862f8e359113) already exists.
2026-02-13 17:31:39.678 UTC [44201] CONTEXT:  COPY copy_intents, line 1
2026-02-13 17:31:39.678 UTC [44201] STATEMENT:  COPY public.copy_intents (intent_id, leader_agent_id, follower_agent_id, source_trade_id, source_tx_hash, mode, chain_key, pair, token_in, token_out, target_amount_usd, leader_amount_usd, sequence, leader_confirmed_at, expires_at, status, rejection_code, rejection_message, created_at, follower_trade_id, updated_at) FROM stdin;
2026-02-13 17:31:39.678 UTC [44201] ERROR:  duplicate key value violates unique constraint "copy_subscriptions_pkey"
2026-02-13 17:31:39.678 UTC [44201] DETAIL:  Key (subscription_id)=(cps_ec825ece78dc9c99f8ff) already exists.
2026-02-13 17:31:39.678 UTC [44201] CONTEXT:  COPY copy_subscriptions, line 1
2026-02-13 17:31:39.678 UTC [44201] STATEMENT:  COPY public.copy_subscriptions (subscription_id, leader_agent_id, follower_agent_id, enabled, scale_bps, max_trade_usd, allowed_tokens, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.678 UTC [44201] ERROR:  duplicate key value violates unique constraint "management_audit_log_pkey"
2026-02-13 17:31:39.678 UTC [44201] DETAIL:  Key (audit_id)=(aud_3001d63044f2c4bb0b8c) already exists.
2026-02-13 17:31:39.678 UTC [44201] CONTEXT:  COPY management_audit_log, line 1
2026-02-13 17:31:39.678 UTC [44201] STATEMENT:  COPY public.management_audit_log (audit_id, agent_id, management_session_id, action_type, action_status, public_redacted_payload, private_payload, user_agent, created_at) FROM stdin;
2026-02-13 17:31:39.678 UTC [44201] ERROR:  duplicate key value violates unique constraint "management_sessions_pkey"
2026-02-13 17:31:39.678 UTC [44201] DETAIL:  Key (session_id)=(msn_7401b12978c8792046b8) already exists.
2026-02-13 17:31:39.678 UTC [44201] CONTEXT:  COPY management_sessions, line 1
2026-02-13 17:31:39.678 UTC [44201] STATEMENT:  COPY public.management_sessions (session_id, agent_id, label, cookie_hash, expires_at, revoked_at, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.679 UTC [44201] ERROR:  duplicate key value violates unique constraint "management_tokens_pkey"
2026-02-13 17:31:39.679 UTC [44201] DETAIL:  Key (token_id)=(mtk_slice8_seed) already exists.
2026-02-13 17:31:39.679 UTC [44201] CONTEXT:  COPY management_tokens, line 1
2026-02-13 17:31:39.679 UTC [44201] STATEMENT:  COPY public.management_tokens (token_id, agent_id, token_ciphertext, token_fingerprint, status, rotated_at, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.679 UTC [44201] ERROR:  duplicate key value violates unique constraint "offdex_settlement_intents_pkey"
2026-02-13 17:31:39.679 UTC [44201] DETAIL:  Key (settlement_intent_id)=(ofi_s10) already exists.
2026-02-13 17:31:39.679 UTC [44201] CONTEXT:  COPY offdex_settlement_intents, line 1
2026-02-13 17:31:39.679 UTC [44201] STATEMENT:  COPY public.offdex_settlement_intents (settlement_intent_id, chain_key, maker_agent_id, taker_agent_id, maker_wallet_address, taker_wallet_address, maker_token, taker_token, maker_amount, taker_amount, escrow_contract, escrow_deal_id, maker_fund_tx_hash, taker_fund_tx_hash, settlement_tx_hash, status, failure_code, failure_message, expires_at, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.679 UTC [44201] ERROR:  duplicate key value violates unique constraint "performance_snapshots_pkey"
2026-02-13 17:31:39.679 UTC [44201] DETAIL:  Key (snapshot_id)=(psn_dde74331ea98abe68e47) already exists.
2026-02-13 17:31:39.679 UTC [44201] CONTEXT:  COPY performance_snapshots, line 1
2026-02-13 17:31:39.679 UTC [44201] STATEMENT:  COPY public.performance_snapshots (snapshot_id, agent_id, "window", pnl_usd, return_pct, volume_usd, win_rate_pct, trades_count, followers_count, created_at, mode, chain_key, score, self_trades_count, copied_trades_count, self_volume_usd, copied_volume_usd, self_pnl_usd, copied_pnl_usd, stale, degraded_reason) FROM stdin;
2026-02-13 17:31:39.679 UTC [44201] ERROR:  duplicate key value violates unique constraint "stepup_challenges_pkey"
2026-02-13 17:31:39.679 UTC [44201] DETAIL:  Key (challenge_id)=(stc_9ae48750a082f8f9bb03) already exists.
2026-02-13 17:31:39.679 UTC [44201] CONTEXT:  COPY stepup_challenges, line 1
2026-02-13 17:31:39.679 UTC [44201] STATEMENT:  COPY public.stepup_challenges (challenge_id, agent_id, code_hash, issued_for, expires_at, consumed_at, failed_attempts, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.679 UTC [44201] ERROR:  duplicate key value violates unique constraint "stepup_sessions_pkey"
2026-02-13 17:31:39.679 UTC [44201] DETAIL:  Key (stepup_session_id)=(stu_d54a43fe2cc67be2c9d8) already exists.
2026-02-13 17:31:39.679 UTC [44201] CONTEXT:  COPY stepup_sessions, line 1
2026-02-13 17:31:39.679 UTC [44201] STATEMENT:  COPY public.stepup_sessions (stepup_session_id, agent_id, management_session_id, expires_at, revoked_at, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.680 UTC [44201] ERROR:  duplicate key value violates unique constraint "trades_pkey"
2026-02-13 17:31:39.680 UTC [44201] DETAIL:  Key (trade_id)=(trd_88acddf113383429119c) already exists.
2026-02-13 17:31:39.680 UTC [44201] CONTEXT:  COPY trades, line 1
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  COPY public.trades (trade_id, agent_id, chain_key, is_mock, status, token_in, token_out, pair, amount_in, amount_out, price_impact_bps, slippage_bps, reason, reason_code, reason_message, tx_hash, mock_receipt_id, error_message, source_trade_id, executed_at, created_at, updated_at) FROM stdin;
2026-02-13 17:31:39.680 UTC [44201] ERROR:  multiple primary keys for table "agent_events" are not allowed
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_events
	    ADD CONSTRAINT agent_events_pkey PRIMARY KEY (event_id);
2026-02-13 17:31:39.680 UTC [44201] ERROR:  multiple primary keys for table "agent_policy_snapshots" are not allowed
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_policy_snapshots
	    ADD CONSTRAINT agent_policy_snapshots_pkey PRIMARY KEY (snapshot_id);
2026-02-13 17:31:39.680 UTC [44201] ERROR:  relation "agent_wallets_agent_id_chain_key_key" already exists
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_wallets
	    ADD CONSTRAINT agent_wallets_agent_id_chain_key_key UNIQUE (agent_id, chain_key);
2026-02-13 17:31:39.680 UTC [44201] ERROR:  multiple primary keys for table "agent_wallets" are not allowed
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_wallets
	    ADD CONSTRAINT agent_wallets_pkey PRIMARY KEY (wallet_id);
2026-02-13 17:31:39.680 UTC [44201] ERROR:  relation "agents_agent_name_key" already exists
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agents
	    ADD CONSTRAINT agents_agent_name_key UNIQUE (agent_name);
2026-02-13 17:31:39.680 UTC [44201] ERROR:  multiple primary keys for table "agents" are not allowed
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agents
	    ADD CONSTRAINT agents_pkey PRIMARY KEY (agent_id);
2026-02-13 17:31:39.680 UTC [44201] ERROR:  multiple primary keys for table "approvals" are not allowed
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.approvals
	    ADD CONSTRAINT approvals_pkey PRIMARY KEY (approval_id);
2026-02-13 17:31:39.680 UTC [44201] ERROR:  relation "copy_intents_follower_agent_id_sequence_key" already exists
2026-02-13 17:31:39.680 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_intents
	    ADD CONSTRAINT copy_intents_follower_agent_id_sequence_key UNIQUE (follower_agent_id, sequence);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "copy_intents" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_intents
	    ADD CONSTRAINT copy_intents_pkey PRIMARY KEY (intent_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "copy_subscriptions" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_subscriptions
	    ADD CONSTRAINT copy_subscriptions_pkey PRIMARY KEY (subscription_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "management_audit_log" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.management_audit_log
	    ADD CONSTRAINT management_audit_log_pkey PRIMARY KEY (audit_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "management_sessions" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.management_sessions
	    ADD CONSTRAINT management_sessions_pkey PRIMARY KEY (session_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "management_tokens" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.management_tokens
	    ADD CONSTRAINT management_tokens_pkey PRIMARY KEY (token_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "offdex_settlement_intents" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.offdex_settlement_intents
	    ADD CONSTRAINT offdex_settlement_intents_pkey PRIMARY KEY (settlement_intent_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "performance_snapshots" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.performance_snapshots
	    ADD CONSTRAINT performance_snapshots_pkey PRIMARY KEY (snapshot_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "stepup_challenges" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.stepup_challenges
	    ADD CONSTRAINT stepup_challenges_pkey PRIMARY KEY (challenge_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "stepup_sessions" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.stepup_sessions
	    ADD CONSTRAINT stepup_sessions_pkey PRIMARY KEY (stepup_session_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  multiple primary keys for table "trades" are not allowed
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.trades
	    ADD CONSTRAINT trades_pkey PRIMARY KEY (trade_id);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  relation "idx_agent_events_created_at" already exists
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  CREATE INDEX idx_agent_events_created_at ON public.agent_events USING btree (created_at DESC);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  relation "idx_agent_wallets_address" already exists
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  CREATE INDEX idx_agent_wallets_address ON public.agent_wallets USING btree (address);
2026-02-13 17:31:39.681 UTC [44201] ERROR:  relation "idx_agents_agent_name" already exists
2026-02-13 17:31:39.681 UTC [44201] STATEMENT:  CREATE INDEX idx_agents_agent_name ON public.agents USING btree (agent_name);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_copy_intents_follower_status" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_copy_intents_follower_status ON public.copy_intents USING btree (follower_agent_id, status, created_at DESC);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_copy_intents_source_follower" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_copy_intents_source_follower ON public.copy_intents USING btree (source_trade_id, follower_agent_id);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_copy_intents_status_expires" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_copy_intents_status_expires ON public.copy_intents USING btree (status, expires_at);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_copy_subscriptions_unique_pair" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE UNIQUE INDEX idx_copy_subscriptions_unique_pair ON public.copy_subscriptions USING btree (leader_agent_id, follower_agent_id);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_management_audit_agent_created_at" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_management_audit_agent_created_at ON public.management_audit_log USING btree (agent_id, created_at DESC);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_management_sessions_agent_expiry" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_management_sessions_agent_expiry ON public.management_sessions USING btree (agent_id, expires_at);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_management_tokens_agent_status" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_management_tokens_agent_status ON public.management_tokens USING btree (agent_id, status);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_offdex_intents_maker_created_at" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_offdex_intents_maker_created_at ON public.offdex_settlement_intents USING btree (maker_agent_id, created_at DESC);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_offdex_intents_status_expires_at" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_offdex_intents_status_expires_at ON public.offdex_settlement_intents USING btree (status, expires_at);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_offdex_intents_taker_created_at" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_offdex_intents_taker_created_at ON public.offdex_settlement_intents USING btree (taker_agent_id, created_at DESC);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_perf_snapshots_agent_window_mode_chain_created" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_perf_snapshots_agent_window_mode_chain_created ON public.performance_snapshots USING btree (agent_id, "window", mode, chain_key, created_at DESC);
2026-02-13 17:31:39.682 UTC [44201] ERROR:  relation "idx_perf_snapshots_window_mode_chain_created" already exists
2026-02-13 17:31:39.682 UTC [44201] STATEMENT:  CREATE INDEX idx_perf_snapshots_window_mode_chain_created ON public.performance_snapshots USING btree ("window", mode, chain_key, created_at DESC);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  relation "idx_stepup_challenges_agent_expiry" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  CREATE INDEX idx_stepup_challenges_agent_expiry ON public.stepup_challenges USING btree (agent_id, expires_at, consumed_at);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  relation "idx_stepup_sessions_agent_expiry" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  CREATE INDEX idx_stepup_sessions_agent_expiry ON public.stepup_sessions USING btree (agent_id, expires_at);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  relation "idx_trades_agent_created_at" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  CREATE INDEX idx_trades_agent_created_at ON public.trades USING btree (agent_id, created_at DESC);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  trigger "management_audit_no_delete" for relation "management_audit_log" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  CREATE TRIGGER management_audit_no_delete BEFORE DELETE ON public.management_audit_log FOR EACH ROW EXECUTE FUNCTION public.forbid_management_audit_mutation();
2026-02-13 17:31:39.683 UTC [44201] ERROR:  trigger "management_audit_no_update" for relation "management_audit_log" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  CREATE TRIGGER management_audit_no_update BEFORE UPDATE ON public.management_audit_log FOR EACH ROW EXECUTE FUNCTION public.forbid_management_audit_mutation();
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "agent_events_agent_id_fkey" for relation "agent_events" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_events
	    ADD CONSTRAINT agent_events_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "agent_events_trade_id_fkey" for relation "agent_events" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_events
	    ADD CONSTRAINT agent_events_trade_id_fkey FOREIGN KEY (trade_id) REFERENCES public.trades(trade_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "agent_policy_snapshots_agent_id_fkey" for relation "agent_policy_snapshots" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_policy_snapshots
	    ADD CONSTRAINT agent_policy_snapshots_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "agent_wallets_agent_id_fkey" for relation "agent_wallets" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.agent_wallets
	    ADD CONSTRAINT agent_wallets_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "approvals_agent_id_fkey" for relation "approvals" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.approvals
	    ADD CONSTRAINT approvals_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "copy_intents_follower_agent_id_fkey" for relation "copy_intents" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_intents
	    ADD CONSTRAINT copy_intents_follower_agent_id_fkey FOREIGN KEY (follower_agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "copy_intents_follower_trade_id_fkey" for relation "copy_intents" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_intents
	    ADD CONSTRAINT copy_intents_follower_trade_id_fkey FOREIGN KEY (follower_trade_id) REFERENCES public.trades(trade_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "copy_intents_leader_agent_id_fkey" for relation "copy_intents" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_intents
	    ADD CONSTRAINT copy_intents_leader_agent_id_fkey FOREIGN KEY (leader_agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "copy_subscriptions_follower_agent_id_fkey" for relation "copy_subscriptions" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_subscriptions
	    ADD CONSTRAINT copy_subscriptions_follower_agent_id_fkey FOREIGN KEY (follower_agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "copy_subscriptions_leader_agent_id_fkey" for relation "copy_subscriptions" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.copy_subscriptions
	    ADD CONSTRAINT copy_subscriptions_leader_agent_id_fkey FOREIGN KEY (leader_agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "management_audit_log_agent_id_fkey" for relation "management_audit_log" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.management_audit_log
	    ADD CONSTRAINT management_audit_log_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "management_audit_log_management_session_id_fkey" for relation "management_audit_log" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.management_audit_log
	    ADD CONSTRAINT management_audit_log_management_session_id_fkey FOREIGN KEY (management_session_id) REFERENCES public.management_sessions(session_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "management_sessions_agent_id_fkey" for relation "management_sessions" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.management_sessions
	    ADD CONSTRAINT management_sessions_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "management_tokens_agent_id_fkey" for relation "management_tokens" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.management_tokens
	    ADD CONSTRAINT management_tokens_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "offdex_settlement_intents_maker_agent_id_fkey" for relation "offdex_settlement_intents" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.offdex_settlement_intents
	    ADD CONSTRAINT offdex_settlement_intents_maker_agent_id_fkey FOREIGN KEY (maker_agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.683 UTC [44201] ERROR:  constraint "offdex_settlement_intents_taker_agent_id_fkey" for relation "offdex_settlement_intents" already exists
2026-02-13 17:31:39.683 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.offdex_settlement_intents
	    ADD CONSTRAINT offdex_settlement_intents_taker_agent_id_fkey FOREIGN KEY (taker_agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.684 UTC [44201] ERROR:  constraint "performance_snapshots_agent_id_fkey" for relation "performance_snapshots" already exists
2026-02-13 17:31:39.684 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.performance_snapshots
	    ADD CONSTRAINT performance_snapshots_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.684 UTC [44201] ERROR:  constraint "stepup_challenges_agent_id_fkey" for relation "stepup_challenges" already exists
2026-02-13 17:31:39.684 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.stepup_challenges
	    ADD CONSTRAINT stepup_challenges_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.684 UTC [44201] ERROR:  constraint "stepup_sessions_agent_id_fkey" for relation "stepup_sessions" already exists
2026-02-13 17:31:39.684 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.stepup_sessions
	    ADD CONSTRAINT stepup_sessions_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:39.684 UTC [44201] ERROR:  constraint "stepup_sessions_management_session_id_fkey" for relation "stepup_sessions" already exists
2026-02-13 17:31:39.684 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.stepup_sessions
	    ADD CONSTRAINT stepup_sessions_management_session_id_fkey FOREIGN KEY (management_session_id) REFERENCES public.management_sessions(session_id);
2026-02-13 17:31:39.684 UTC [44201] ERROR:  constraint "trades_agent_id_fkey" for relation "trades" already exists
2026-02-13 17:31:39.684 UTC [44201] STATEMENT:  ALTER TABLE ONLY public.trades
	    ADD CONSTRAINT trades_agent_id_fkey FOREIGN KEY (agent_id) REFERENCES public.agents(agent_id);
2026-02-13 17:31:52.527 UTC [44274] ERROR:  permission denied to create database
2026-02-13 17:31:52.527 UTC [44274] STATEMENT:  create database xclaw_restore_drill;
2026-02-13 17:32:37.756 UTC [44760] ERROR:  type "agent_event_type" already exists
2026-02-13 17:32:37.756 UTC [44760] STATEMENT:  CREATE TYPE public.agent_event_type AS ENUM (
	    'heartbeat',
	    'trade_proposed',
	    'trade_approval_pending',
	    'trade_approved',
	    'trade_rejected',
	    'trade_executing',
	    'trade_verifying',
	    'trade_filled',
	    'trade_failed',
	    'trade_expired',
	    'trade_verification_timeout',
	    'policy_changed'
	);
2026-02-13 17:33:50.338 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 17:33:58.398 UTC [9394] LOG:  checkpoint complete: wrote 81 buffers (0.5%); 0 WAL file(s) added, 0 removed, 0 recycled; write=8.025 s, sync=0.013 s, total=8.060 s; sync files=45, longest=0.006 s, average=0.001 s; distance=200 kB, estimate=285 kB; lsn=0/1F1DCA8, redo lsn=0/1F1DC18
2026-02-13 17:48:50.606 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 17:48:52.359 UTC [9394] LOG:  checkpoint complete: wrote 18 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.712 s, sync=0.012 s, total=1.753 s; sync files=15, longest=0.009 s, average=0.001 s; distance=37 kB, estimate=260 kB; lsn=0/1F270F8, redo lsn=0/1F270A0
2026-02-13 18:28:51.091 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 18:28:53.640 UTC [9394] LOG:  checkpoint complete: wrote 26 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=2.514 s, sync=0.012 s, total=2.550 s; sync files=25, longest=0.009 s, average=0.001 s; distance=63 kB, estimate=240 kB; lsn=0/1F370C8, redo lsn=0/1F37038
2026-02-13 18:33:51.657 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 18:33:53.416 UTC [9394] LOG:  checkpoint complete: wrote 18 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.711 s, sync=0.019 s, total=1.759 s; sync files=18, longest=0.014 s, average=0.002 s; distance=31 kB, estimate=219 kB; lsn=0/1F3F070, redo lsn=0/1F3EFE0
2026-02-13 18:43:51.534 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 18:43:52.276 UTC [9394] LOG:  checkpoint complete: wrote 8 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.708 s, sync=0.009 s, total=0.742 s; sync files=7, longest=0.006 s, average=0.002 s; distance=6 kB, estimate=198 kB; lsn=0/1F40BB0, redo lsn=0/1F40B58
2026-02-13 18:48:51.361 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 18:48:52.103 UTC [9394] LOG:  checkpoint complete: wrote 8 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.707 s, sync=0.010 s, total=0.742 s; sync files=8, longest=0.007 s, average=0.002 s; distance=15 kB, estimate=180 kB; lsn=0/1F44930, redo lsn=0/1F448A0
2026-02-13 18:58:51.206 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 18:58:56.061 UTC [9394] LOG:  checkpoint complete: wrote 49 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=4.818 s, sync=0.010 s, total=4.855 s; sync files=34, longest=0.006 s, average=0.001 s; distance=177 kB, estimate=179 kB; lsn=0/1F70D30, redo lsn=0/1F70CD8
2026-02-13 19:18:51.262 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 19:18:54.115 UTC [9394] LOG:  checkpoint complete: wrote 29 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=2.814 s, sync=0.013 s, total=2.853 s; sync files=27, longest=0.009 s, average=0.001 s; distance=77 kB, estimate=169 kB; lsn=0/1F841E0, redo lsn=0/1F84150
2026-02-13 19:23:51.153 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 19:23:52.604 UTC [9394] LOG:  checkpoint complete: wrote 15 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.411 s, sync=0.012 s, total=1.452 s; sync files=8, longest=0.009 s, average=0.002 s; distance=62 kB, estimate=158 kB; lsn=0/1F93A18, redo lsn=0/1F939C0
2026-02-13 19:27:27.885 UTC [89727] ERROR:  relation "wallet_balance_snapshots" does not exist at character 22
2026-02-13 19:27:27.885 UTC [89727] STATEMENT:  
	        insert into wallet_balance_snapshots (
	          snapshot_id, agent_id, chain_key, token, balance, block_number, observed_at, created_at
	        ) values ($1, $2, $3, $4, $5, $6, now(), now())
	        on conflict (agent_id, chain_key, token)
	        do update set balance = excluded.balance, block_number = excluded.block_number, observed_at = now()
	        
2026-02-13 19:27:27.886 UTC [89727] ERROR:  relation "wallet_balance_snapshots" does not exist at character 94
2026-02-13 19:27:27.886 UTC [89727] STATEMENT:  
	          select token, balance::text, block_number::text, observed_at::text
	          from wallet_balance_snapshots
	          where agent_id = $1 and chain_key = $2
	          order by token asc
	          
2026-02-13 19:27:27.889 UTC [90047] ERROR:  relation "deposit_events" does not exist at character 111
2026-02-13 19:27:27.889 UTC [90047] STATEMENT:  
	          select token, amount::text, tx_hash, block_number::text, confirmed_at::text, status
	          from deposit_events
	          where agent_id = $1 and chain_key = $2
	          order by confirmed_at desc
	          limit 25
	          
2026-02-13 19:27:28.026 UTC [90056] ERROR:  relation "limit_orders" does not exist at character 22
2026-02-13 19:27:28.026 UTC [90056] STATEMENT:  
	        insert into limit_orders (
	          order_id, agent_id, chain_key, mode, side, token_in, token_out,
	          amount_in, limit_price, slippage_bps, status, expires_at, trigger_source, created_at, updated_at
	        ) values ($1, $2, $3, $4::policy_mode, $5::limit_order_side, $6, $7, $8, $9, $10, 'open', $11, 'management_api', now(), now())
	        
2026-02-13 19:28:16.612 UTC [90694] ERROR:  type "runtime_platform" already exists
2026-02-13 19:28:16.612 UTC [90694] STATEMENT:  -- X-Claw canonical MVP migration baseline (Slice 02 contract freeze)
	
	create extension if not exists pgcrypto;
	
	create type runtime_platform as enum ('windows', 'linux', 'macos');
	create type public_status as enum ('active', 'offline', 'degraded', 'paused', 'deactivated');
	create type custody_type as enum ('agent_local');
	create type policy_mode as enum ('mock', 'real');
	create type policy_approval_mode as enum ('per_trade', 'auto');
	
	create type trade_status as enum (
	  'proposed',
	  'approval_pending',
	  'approved',
	  'rejected',
	  'executing',
	  'verifying',
	  'filled',
	  'failed',
	  'expired',
	  'verification_timeout'
	);
	
	create type agent_event_type as enum (
	  'heartbeat',
	  'trade_proposed',
	  'trade_approval_pending',
	  'trade_approved',
	  'trade_rejected',
	  'trade_executing',
	  'trade_verifying',
	  'trade_filled',
	  'trade_failed',
	  'trade_expired',
	  'trade_verification_timeout',
	  'policy_changed'
	);
	
	create type performance_window as enum ('24h', '7d', '30d', 'all');
	create type management_token_status as enum ('active', 'rotated', 'revoked');
	create type stepup_issued_for as enum ('withdraw', 'approval_scope_change', 'sensitive_action');
	create type management_action_status as enum ('accepted', 'rejected', 'failed');
	create type approval_scope as enum ('trade', 'pair', 'global');
	create type approval_status as enum ('active', 'revoked', 'expired', 'consumed');
	create type offdex_settlement_status as enum (
	  'proposed',
	  'accepted',
	  'maker_funded',
	  'taker_funded',
	  'ready_to_settle',
	  'settling',
	  'settled',
	  'cancelled',
	  'expired',
	  'failed'
	);
	
	create table if not exists agents (
	  agent_id text primary key,
	  agent_name varchar(32) unique not null,
	  description varchar(280),
	  owner_label varchar(64),
	  runtime_platform runtime_platform not null default 'linux',
	  openclaw_runtime_id varchar(128),
	  openclaw_metadata jsonb not null default '{}'::jsonb,
	  public_status public_status not null default 'offline',
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now()
	);
	
	create table if not exists agent_wallets (
	  wallet_id text primary key,
	  agent_id text not null references agents(agent_id),
	  chain_key varchar(64) not null,
	  address varchar(128) not null,
	  custody custody_type not null default 'agent_local',
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now(),
	  unique (agent_id, chain_key)
	);
	
	create table if not exists agent_policy_snapshots (
	  snapshot_id text primary key,
	  agent_id text not null references agents(agent_id),
	  mode policy_mode not null,
	  approval_mode policy_approval_mode not null,
	  max_trade_usd numeric,
	  max_daily_usd numeric,
	  allowed_tokens jsonb not null default '[]'::jsonb,
	  created_at timestamptz not null default now()
	);
	
	create table if not exists trades (
	  trade_id text primary key,
	  agent_id text not null references agents(agent_id),
	  chain_key varchar(64) not null,
	  is_mock boolean not null,
	  status trade_status not null,
	  token_in varchar(128) not null,
	  token_out varchar(128) not null,
	  pair varchar(128) not null,
	  amount_in numeric,
	  amount_out numeric,
	  price_impact_bps int,
	  slippage_bps int,
	  reason varchar(140),
	  reason_code varchar(64),
	  reason_message text,
	  tx_hash varchar(128),
	  mock_receipt_id varchar(128),
	  error_message text,
	  source_trade_id text,
	  executed_at timestamptz,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now(),
	  constraint trade_execution_id_check
	    check ((tx_hash is not null) or (mock_receipt_id is not null) or status in ('proposed', 'approval_pending', 'approved', 'rejected', 'expired'))
	);
	
	create table if not exists agent_events (
	  event_id text primary key,
	  agent_id text not null references agents(agent_id),
	  trade_id text references trades(trade_id),
	  event_type agent_event_type not null,
	  payload jsonb not null default '{}'::jsonb,
	  created_at timestamptz not null default now()
	);
	
	create table if not exists performance_snapshots (
	  snapshot_id text primary key,
	  agent_id text not null references agents(agent_id),
	  "window" performance_window not null,
	  pnl_usd numeric,
	  return_pct numeric,
	  volume_usd numeric,
	  win_rate_pct numeric,
	  trades_count int not null default 0,
	  followers_count int not null default 0,
	  created_at timestamptz not null default now()
	);
	
	create table if not exists copy_subscriptions (
	  subscription_id text primary key,
	  leader_agent_id text not null references agents(agent_id),
	  follower_agent_id text not null references agents(agent_id),
	  enabled boolean not null default true,
	  scale_bps int not null default 10000,
	  max_trade_usd numeric,
	  allowed_tokens jsonb,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now()
	);
	
	create table if not exists management_tokens (
	  token_id text primary key,
	  agent_id text not null references agents(agent_id),
	  token_ciphertext text not null,
	  token_fingerprint varchar(128) not null,
	  status management_token_status not null default 'active',
	  rotated_at timestamptz,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now()
	);
	
	create table if not exists management_sessions (
	  session_id text primary key,
	  agent_id text not null references agents(agent_id),
	  label varchar(64),
	  cookie_hash varchar(255) not null,
	  expires_at timestamptz not null,
	  revoked_at timestamptz,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now()
	);
	
	create table if not exists stepup_challenges (
	  challenge_id text primary key,
	  agent_id text not null references agents(agent_id),
	  code_hash varchar(255) not null,
	  issued_for stepup_issued_for not null,
	  expires_at timestamptz not null,
	  consumed_at timestamptz,
	  failed_attempts int not null default 0,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now()
	);
	
	create table if not exists stepup_sessions (
	  stepup_session_id text primary key,
	  agent_id text not null references agents(agent_id),
	  management_session_id text not null references management_sessions(session_id),
	  expires_at timestamptz not null,
	  revoked_at timestamptz,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now()
	);
	
	create table if not exists management_audit_log (
	  audit_id text primary key,
	  agent_id text not null references agents(agent_id),
	  management_session_id text references management_sessions(session_id),
	  action_type varchar(64) not null,
	  action_status management_action_status not null,
	  public_redacted_payload jsonb not null default '{}'::jsonb,
	  private_payload jsonb not null default '{}'::jsonb,
	  user_agent text,
	  created_at timestamptz not null default now()
	);
	
	create table if not exists offdex_settlement_intents (
	  settlement_intent_id text primary key,
	  chain_key varchar(64) not null,
	  maker_agent_id text not null references agents(agent_id),
	  taker_agent_id text references agents(agent_id),
	  maker_wallet_address varchar(128) not null,
	  taker_wallet_address varchar(128),
	  maker_token varchar(128) not null,
	  taker_token varchar(128) not null,
	  maker_amount numeric not null,
	  taker_amount numeric not null,
	  escrow_contract varchar(128) not null,
	  escrow_deal_id varchar(128),
	  maker_fund_tx_hash varchar(128),
	  taker_fund_tx_hash varchar(128),
	  settlement_tx_hash varchar(128),
	  status offdex_settlement_status not null,
	  failure_code varchar(64),
	  failure_message text,
	  expires_at timestamptz not null,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now()
	);
	
	-- Compatibility tables retained for existing contract artifacts.
	create table if not exists approvals (
	  approval_id text primary key,
	  agent_id text not null references agents(agent_id),
	  chain_key varchar(64) not null,
	  scope approval_scope not null,
	  status approval_status not null,
	  trade_ref text,
	  pair_ref varchar(128),
	  requires_stepup boolean not null default false,
	  granted_by_session_id text,
	  direction varchar(32) not null default 'non_directional',
	  max_amount_usd numeric(18, 8) not null,
	  slippage_bps_max int not null,
	  resubmit_window_sec int not null default 600,
	  resubmit_amount_tolerance_bps int not null default 1000,
	  max_retries int not null default 3,
	  expires_at timestamptz not null,
	  created_at timestamptz not null default now(),
	  updated_at timestamptz not null default now(),
	  constraint approval_scope_ref_check check (
	    (scope = 'trade' and trade_ref is not null) or
	    (scope = 'pair' and pair_ref is not null) or
	    (scope = 'global' and trade_ref is null and pair_ref is null)
	  )
	);
	
	create table if not exists copy_intents (
	  intent_id text primary key,
	  leader_agent_id text not null references agents(agent_id),
	  follower_agent_id text not null references agents(agent_id),
	  source_trade_id text not null,
	  source_tx_hash varchar(128),
	  mode policy_mode not null,
	  chain_key varchar(64) not null,
	  pair varchar(128) not null,
	  token_in varchar(128) not null,
	  token_out varchar(128) not null,
	  target_amount_usd numeric not null,
	  leader_amount_usd numeric not null,
	  sequence bigint not null,
	  leader_confirmed_at timestamptz not null,
	  expires_at timestamptz not null,
	  status varchar(32) not null,
	  rejection_code varchar(64),
	  rejection_message text,
	  created_at timestamptz not null default now(),
	  unique (follower_agent_id, sequence)
	);
	
	-- append-only enforcement for management audit log
	create or replace function forbid_management_audit_mutation()
	returns trigger
	language plpgsql
	as $$
	begin
	  raise exception 'management_audit_log is append-only';
	end;
	$$;
	
	drop trigger if exists management_audit_no_update on management_audit_log;
	create trigger management_audit_no_update
	before update on management_audit_log
	for each row
	execute function forbid_management_audit_mutation();
	
	drop trigger if exists management_audit_no_delete on management_audit_log;
	create trigger management_audit_no_delete
	before delete on management_audit_log
	for each row
	execute function forbid_management_audit_mutation();
	
	create index if not exists idx_trades_agent_created_at on trades(agent_id, created_at desc);
	create index if not exists idx_agents_agent_name on agents(agent_name);
	create index if not exists idx_agent_wallets_address on agent_wallets(address);
	create index if not exists idx_agent_events_created_at on agent_events(created_at desc);
	create index if not exists idx_management_tokens_agent_status on management_tokens(agent_id, status);
	create index if not exists idx_management_sessions_agent_expiry on management_sessions(agent_id, expires_at);
	create index if not exists idx_stepup_challenges_agent_expiry on stepup_challenges(agent_id, expires_at, consumed_at);
	create index if not exists idx_stepup_sessions_agent_expiry on stepup_sessions(agent_id, expires_at);
	create index if not exists idx_management_audit_agent_created_at on management_audit_log(agent_id, created_at desc);
	create index if not exists idx_offdex_intents_maker_created_at on offdex_settlement_intents(maker_agent_id, created_at desc);
	create index if not exists idx_offdex_intents_taker_created_at on offdex_settlement_intents(taker_agent_id, created_at desc);
	create index if not exists idx_offdex_intents_status_expires_at on offdex_settlement_intents(status, expires_at);
	create index if not exists idx_copy_intents_follower_status on copy_intents(follower_agent_id, status, created_at desc);
	
2026-02-13 19:28:51.662 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 19:29:04.695 UTC [9394] LOG:  checkpoint complete: wrote 129 buffers (0.8%); 0 WAL file(s) added, 0 removed, 1 recycled; write=12.942 s, sync=0.062 s, total=13.033 s; sync files=97, longest=0.007 s, average=0.001 s; distance=528 kB, estimate=528 kB; lsn=0/2026A58, redo lsn=0/2017CC0
2026-02-13 19:33:51.790 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 19:33:57.349 UTC [9394] LOG:  checkpoint complete: wrote 56 buffers (0.3%); 0 WAL file(s) added, 0 removed, 0 recycled; write=5.521 s, sync=0.014 s, total=5.559 s; sync files=45, longest=0.006 s, average=0.001 s; distance=176 kB, estimate=493 kB; lsn=0/2043E88, redo lsn=0/2043DF8
2026-02-13 20:33:51.968 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 20:33:52.603 UTC [9394] LOG:  checkpoint complete: wrote 6 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.602 s, sync=0.006 s, total=0.635 s; sync files=3, longest=0.006 s, average=0.002 s; distance=6 kB, estimate=444 kB; lsn=0/20458F0, redo lsn=0/2045898
2026-02-13 20:43:51.734 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 20:43:57.895 UTC [9394] LOG:  checkpoint complete: wrote 62 buffers (0.4%); 0 WAL file(s) added, 0 removed, 0 recycled; write=6.122 s, sync=0.014 s, total=6.161 s; sync files=46, longest=0.006 s, average=0.001 s; distance=234 kB, estimate=423 kB; lsn=0/20801F0, redo lsn=0/2080160
2026-02-13 21:28:52.452 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 21:28:53.799 UTC [9394] LOG:  checkpoint complete: wrote 14 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.313 s, sync=0.010 s, total=1.347 s; sync files=14, longest=0.007 s, average=0.001 s; distance=26 kB, estimate=384 kB; lsn=0/2086C00, redo lsn=0/2086BA8
2026-02-13 21:33:52.859 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 21:33:55.310 UTC [9394] LOG:  checkpoint complete: wrote 25 buffers (0.2%); 0 WAL file(s) added, 0 removed, 0 recycled; write=2.416 s, sync=0.011 s, total=2.452 s; sync files=21, longest=0.008 s, average=0.001 s; distance=82 kB, estimate=353 kB; lsn=0/209B630, redo lsn=0/209B5D8
2026-02-13 22:03:52.673 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 22:03:53.214 UTC [9394] LOG:  checkpoint complete: wrote 5 buffers (0.0%); 0 WAL file(s) added, 0 removed, 0 recycled; write=0.504 s, sync=0.010 s, total=0.542 s; sync files=4, longest=0.006 s, average=0.003 s; distance=11 kB, estimate=319 kB; lsn=0/209E488, redo lsn=0/209E430
2026-02-13 22:08:52.270 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 22:08:53.615 UTC [9394] LOG:  checkpoint complete: wrote 14 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.311 s, sync=0.011 s, total=1.345 s; sync files=14, longest=0.008 s, average=0.001 s; distance=29 kB, estimate=290 kB; lsn=0/20A5A08, redo lsn=0/20A59B0
2026-02-13 22:13:52.676 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 22:13:54.227 UTC [9394] LOG:  checkpoint complete: wrote 16 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.509 s, sync=0.014 s, total=1.551 s; sync files=15, longest=0.009 s, average=0.001 s; distance=24 kB, estimate=263 kB; lsn=0/20ABA18, redo lsn=0/20AB9C0
2026-02-13 22:28:52.436 UTC [9394] LOG:  checkpoint starting: time
2026-02-13 22:28:53.781 UTC [9394] LOG:  checkpoint complete: wrote 14 buffers (0.1%); 0 WAL file(s) added, 0 removed, 0 recycled; write=1.311 s, sync=0.011 s, total=1.346 s; sync files=14, longest=0.008 s, average=0.001 s; distance=24 kB, estimate=240 kB; lsn=0/20B1B60, redo lsn=0/20B1B08
